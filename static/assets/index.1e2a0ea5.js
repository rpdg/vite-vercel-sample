import{c as f,b as h,d as U,U as I,u as D,S as L,a as N,L as Y}from"./index.bf4350c5.js";import{u as y}from"./vue-i18n.f56f8be1.js";import{d as O}from"./avator_red.2a3a1020.js";import{S as J,e as S,I as V,B as z,J as w}from"./ant-design-vue.9c53cc52.js";import{b as E}from"./BussinessCardStore.8c55b86e.js";import{d as b,k as e,i as P,u as j,l as A,o as R,c as G,n as W}from"./@vue.b2913f50.js";import"./@rpdg.8b8261fd.js";import"./vue-router.82b024de.js";import"./moment.29305b8e.js";import"./@ant-design.148651e0.js";import"./@ctrl.2e36ce53.js";import"./nprogress.9dcdc490.js";import"./axios.7aed06b8.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.647f38fa.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.e28dde39.js";import"./source-map.e9534891.js";import"./vue.7093eef6.js";const F="_chatList_1qx44_1",K="_chatItem_1qx44_1",Q="_avata_1qx44_12",X="_content_1qx44_19",Z="_time_1qx44_23",ee="_msg_1qx44_29",te="_chatSection_1qx44_43",se="_targetUserInfo_1qx44_46",ae="_info_1qx44_57",ne="_chatMsgBox_1qx44_61",re="_invite_1qx44_69",oe="_refused_1qx44_81",ie="_fromMe_1qx44_85",ce="_invite_title_1qx44_88",le="_invite_content_1qx44_91",de="_imgPhoto_1qx44_103",ue="_bubble_1qx44_107",me="_left_1qx44_121",ge="_right_1qx44_136",_e="_sender_1qx44_152";var s={chatList:F,chatItem:K,avata:Q,content:X,time:Z,msg:ee,chatSection:te,targetUserInfo:se,info:ae,chatMsgBox:ne,invite:re,refused:oe,fromMe:ie,invite_title:ce,invite_content:le,imgPhoto:de,bubble:ue,left:me,right:ge,sender:_e};function T(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!P(r)}var pe=b({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(r){const{t:o}=y(),{chatStore:c}=U(),{msg:t,targetUserName:i}=r;let _=JSON.parse(t.msgcontent);async function d(){await E.accpetCardExchange(t.from_barcode),c.getChattingMessages(h.user.barcode)}async function p(){await E.denyCardExchange(t.id),c.getChattingMessages(h.user.barcode)}return()=>{if(t.from_barcode===r.selfBarCode)return e("div",{key:t.id,class:`pd_20 ${s.invite}  ${s.fromMe}`},[e("p",{class:s.invite_title},[o("myItb.chat.request_business_card_from_you",{name:i})]),e("img",{src:f(_.ToCompanyLogo),class:s.imgPhoto},null),e("p",{class:"pd_t_20"},[o(`myItb.meetingRequests.status_long[${t.scheduleaccept}]`)])]);{let m,u;return e("div",{key:t.id,class:`pd_20 ${s.invite}`},[e("p",{class:s.invite_title},[o("myItb.chat.request_business_card_to_you",{name:i})]),e("img",{src:f(t.from_HeadImageUrl),class:s.imgPhoto},null),t.scheduleaccept===0&&e(J,{class:"pd_t_20",size:"small"},{default:()=>[e(S,{onClick:p},T(m=o("common.deny"))?m:{default:()=>[m]}),e(S,{onClick:d,type:"primary"},T(u=o("common.accept"))?u:{default:()=>[u]})]}),t.scheduleaccept!=0&&e("p",null,[o(`myItb.meetingRequests.status_long[${t.scheduleaccept}]`)])])}}}}),fe=b({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(r){const{msg:o,selfBarCode:c}=r;return()=>e("div",{key:o.id,class:`${s.bubble} ${o.to_barcode===c?s.left:s.right}`},[e("p",null,[o.msgcontent])])}}),be=b({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(r){const{t:o}=y(),{msg:c,targetUserName:t}=r;let i=JSON.parse(c.msgcontent);return i.beginDate=I(i.beginDate,h.minutesOffset),i.endDate=I(i.endDate,h.minutesOffset),()=>c.from_barcode===r.selfBarCode?e("div",{class:`pd_20 ${s.invite} ${s.fromMe}`,key:c.id},[e("p",{class:s.invite_title},[o("myItb.chat.you_invite_attend"),j(" "),t]),e("div",{class:s.invite_content},[e("img",{src:f(c.from_HeadImageUrl),alt:""},null),e("img",{src:f(c.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${i.beginDate.substr(0,10)}`,e("br",null,null),`${i.beginDate.substr(11,5)} ~ ${i.endDate.substr(11,5)}`]),e("p",null,null)])])]):e("div",{class:`pd_20 ${s.invite}`,key:c.id,onClick:()=>{}},[e("p",{class:s.invite_title},[t,j(" "),o("myItb.chat.invite_you_attend")]),e("div",{class:s.invite_content},[e("img",{src:f(c.from_HeadImageUrl),alt:""},null),e("img",{src:f(c.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${i.beginDate.substr(0,10)}`,e("br",null,null),`${i.beginDate.substr(11,5)} ~ ${i.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function ve(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!P(r)}var ye=b({name:"Chat",setup(){var n,C,x,M;const{t:r}=y(),{appStore:o}=N(),{authenStore:c}=D(),{chatStore:t}=U(),i=A(""),_=A(),d=c.user.barcode;R(async()=>{t.targetUser&&(await t.getChattingMessages(t.targetUser.employee_id),p())});function p(){let g=_.value;g.scrollTop=g.scrollHeight}async function m(){i.value&&(await t.sendChattingMessage(i.value),i.value="",W(p))}function u(g){return g.map(l=>{if(l.msgtype<2)return e(fe,{key:l.id,msg:l,selfBarCode:d},null);if(l.msgtype<6)return e(be,{key:l.id,msg:l,targetUserName:a.name,selfBarCode:d},null);if(l.msgtype===6)return e(pe,{key:l.id,msg:l,targetUserName:a.name,selfBarCode:d},null)})}let a=G({name:o.isEn?((n=t.targetUser)==null?void 0:n.firstname)+" "+((C=t.targetUser)==null?void 0:C.lastname):""+((x=t.targetUser)==null?void 0:x.lastname_cn)+((M=t.targetUser)==null?void 0:M.firstname_cn)});return()=>{var g,l,q,k,$,B,H;return e("section",{class:s.chatSection,key:(g=t.targetUser)==null?void 0:g.employee_id},[e("div",{class:s.targetUserInfo},[((l=t.targetUser)==null?void 0:l.HeadImageUrl)!=null&&((q=t.targetUser)==null?void 0:q.HeadImageUrl)!=""?e("img",{class:s.avata,src:`${L}${(k=t.targetUser)==null?void 0:k.HeadImageUrl}`},null):e("img",{class:s.avata,src:O},null),e("div",{class:s.info},[e("h4",null,[a.name]),e("div",null,[o.isEn?($=t.targetUser)==null?void 0:$.company:(B=t.targetUser)==null?void 0:B.company_cn]),e("div",null,[(H=t.targetUser)==null?void 0:H.job_title])])]),e("div",{ref:_,class:s.chatMsgBox},[t.chattingMsgs&&u(t.chattingMsgs)]),e("div",{class:s.sender},[e(V,{type:"text",value:i.value,"onUpdate:value":v=>i.value=v},{suffix:()=>{let v;return e(S,{style:{backgroundColor:"black",color:"white"},onClick:m},ve(v=r("myItb.chat.send"))?v:{default:()=>[v]})}})])])}}}),he=b({name:"MsgList",setup(){var u;const{t:r}=y(),{appStore:o}=N(),{authenStore:c}=D(),{chatStore:t}=U(),i=(u=c.user)==null?void 0:u.barcode;function _(a){return o.isEn?a.firstname+" "+a.lastname:a.lastname_cn+a.firstname_cn}R(()=>{t.chattingMsgs=t.targetUser=void 0,t.lastMessages?t.getLastMessages():t.refreshMsgList()});function d(a){let n={job_title:a.job_title,employee_id:a.barcode,HeadImageUrl:a.HeadImageUrl,firstname_cn:a.firstname_cn,firstname:a.firstname,lastname_cn:a.lastname_cn,lastname:a.lastname,logoUrl:a.logoUrl,company:a.company,company_cn:a.company_cn,IsOnline:0};t.chatWith(n)}function p(a){let n=a.last_message;if(n.msgtype===0)return e("span",null,[n.msgcontent]);if(n.msgtype===1)return e("span",null,[r("myItb.messages.reply_message")]);if(n.msgtype>1&&n.msgtype<6)return e("span",null,[r("myItb.messages.invite_message")]);if(n.msgtype===6)return e("span",null,[r("myItb.messages.card_message")])}function m(a){return a.length>0?a.map(n=>e("div",{key:n.barcode,class:s.chatItem,onClick:()=>{d(n)}},[n.HeadImageUrl!=null&&n.HeadImageUrl!=""?e("img",{class:s.avata,src:`${L}${n.HeadImageUrl}`,onClick:()=>{d(n)}},null):e("img",{class:s.avata,src:O,onClick:()=>{d(n)}},null),e("div",{class:s.content},[e("span",{class:s.time},[I(n.last_message.createdatetime,c.minutesOffset,"YYYY-MM-DD")]),e(z,{dot:n.last_message.from_barcode!=i&&n.last_message.status===0},{default:()=>[e("h4",null,[_(n),j(" ")])]}),e("div",{class:s.msg},[p(n)])])])):e(w,{image:w.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:s.chatList},[t.lastMessages?m(t.lastMessages):e(Y,null,null)])}}),We=b({name:"ChatSection",setup(){const{t:r}=y(),{chatStore:o}=U();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{o.chattingMsgs=o.targetUser=void 0,o.viewState=0}},[r("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[o.viewState===0?e(he,null,null):e(ye,null,null)])])}});export{We as default};
