import{b as e,u as a,a as t,L as s,U as r}from"./index.0c803cf8.js";import{u as l}from"./vue-i18n.bbad715b.js";import{I as n,l as o,B as i,E as c}from"./ant-design-vue.7426a550.js";import{a2 as u,a0 as d,k as m,aq as p,ag as _,aj as g,al as v}from"./@vue.5723de44.js";import"./vue-router.0532eeed.js";import"./@ant-design.eb6e5cf6.js";import"./@ctrl.2e36ce53.js";import"./moment.29305b8e.js";import"./nprogress.3e43c680.js";import"./axios.a57df465.js";import"./@babel.dc475c8c.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.60ec16aa.js";import"./warning.4abaefa0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.c2b61631.js";import"./source-map.3671d69c.js";import"./vue.3a1030aa.js";var j="_chatList_1jupu_1",f="_chatItem_1jupu_1",b="_avata_1jupu_12",h="_content_1jupu_19",y="_time_1jupu_23",M="_msg_1jupu_29",U="_chatSection_1jupu_41",S="_targetUserInfo_1jupu_44",C="_info_1jupu_54",I="_chatMsgBox_1jupu_58",k="_bubble_1jupu_66",E="_left_1jupu_78",w="_right_1jupu_93",x="_sender_1jupu_109",L=u({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(e){const{msg:a,selfBarCode:t}=e;return()=>d("div",{key:a.id,class:`${k} ${a.to_barcode===t?E:w}`},[d("p",null,[a.msgcontent])])}});var B=u({name:"Chat",setup(){const{t:s}=l(),{appStore:r}=a(),{authenStore:i}=e(),{chatStore:c}=t(),u=m(""),v=m(),j=i.user.barcode;function f(){let e=v.value;e.scrollTop=e.scrollHeight}async function h(){u.value&&(await c.sendChattingMessage(u.value),u.value="",g(f))}return p((async()=>{await c.getChattingMessages(j),f()})),()=>{var e,a,t,l,i,m,p,g,f;return d("section",{class:U},[d("div",{class:S},[d("img",{class:b,src:null==(e=c.targetUser)?void 0:e.HeadImageUrl},null),d("div",{class:C},[d("h4",null,[r.isEn?(null==(a=c.targetUser)?void 0:a.firstname)+" "+(null==(t=c.targetUser)?void 0:t.lastname):""+(null==(l=c.targetUser)?void 0:l.lastname_cn)+(null==(i=c.targetUser)?void 0:i.firstname_cn)]),d("div",null,[null==(m=c.targetUser)?void 0:m.job_title]),d("div",null,[r.isEn?null==(p=c.targetUser)?void 0:p.company:null==(g=c.targetUser)?void 0:g.company_cn])])]),d("div",{ref:v,class:I},[null==(f=c.chattingMsgs)?void 0:f.map((e=>d(L,{key:e.id,msg:e,selfBarCode:j},null)))]),d("div",{class:x},[d(n,{type:"text",value:u.value,"onUpdate:value":e=>u.value=e},{suffix:()=>{let e;return d(o,{style:{backgroundColor:"black",color:"white"},onClick:h},"function"==typeof(a=e=s("myItb.chat.send"))||"[object Object]"===Object.prototype.toString.call(a)&&!_(a)?e:{default:()=>[e]});var a}})])])}}}),H=u({name:"MsgList",setup(){var l;const{appStore:n}=a(),{authenStore:o}=e(),{chatStore:u}=t(),m=null==(l=o.user)?void 0:l.barcode;function p(e){let a={job_title:e.job_title,employee_id:e.barcode,HeadImageUrl:e.HeadImageUrl,firstname_cn:e.firstname_cn,firstname:e.firstname,lastname_cn:e.lastname_cn,lastname:e.lastname,company:e.company,company_cn:e.company_cn};u.chatWith(a)}return v((()=>{u.lastMessages?u.getLastMessages():u.refreshMsgList()})),()=>{return d("div",{class:j},[u.lastMessages?(e=u.lastMessages,e.length>0?e.map((e=>d("div",{key:e.barcode,class:f},[d("img",{class:b,src:e.HeadImageUrl,onClick:()=>{p(e)}},null),d("div",{class:h},[d("span",{class:y},[r(e.last_message.createdatetime,o.minutesOffset,"YYYY-MM-DD")]),d(i,{dot:e.last_message.from_barcode!=m&&0===e.last_message.status},{default:()=>[d("h4",{onClick:()=>{p(e)}},[n.isEn?e.firstname+" "+e.lastname:e.lastname_cn+e.firstname_cn," "])]}),d("div",{class:M},[e.last_message.msgcontent])])]))):d(c,{image:c.PRESENTED_IMAGE_SIMPLE},null)):d(s,null,null)]);var e}}}),O=u({name:"ChatSection",setup(){const{t:e}=l(),{chatStore:a}=t();return()=>d("div",{class:"ant-card ant-card-bordered"},[d("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[d("div",{class:"ant-card-head-wrapper"},[d("div",{class:"ant-card-head-title"},[e("myItb.dockIcons.chat")])])]),d("div",{class:"ant-card-body",style:"padding: 2px;"},[0===a.viewState?d(H,null,null):d(B,null,null)])])}});export default O;
