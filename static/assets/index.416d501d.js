var e=Object.defineProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,t=(a,r,o)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o;import{L as s,s as l}from"./index.module.ba4ef8ce.js";import{h as u,u as n,a as d,F as c,I as i,U as p,w as V,x as g,o as m,y as f}from"./vendor.7b3e9c73.js";axios.defaults.baseURL="/",axios.defaults.timeout=3e4,axios.defaults.headers.post["Content-Type"]="application/json";const v=axios.create();v.interceptors.response.use((e=>{const a=e.data;return a.error?(alert(a.error),Promise.reject(new Error(a.error))):e}),(e=>{var a,r;const o=e.response;return o&&o.status&&o.data&&(o.status,alert(o.data.Message)),Promise.reject(new Error(null!=(r=null==(a=null==o?void 0:o.data)?void 0:a.error)?r:"Network error"))}));const{CancelToken:N,isCancel:b}=axios;async function w(e,s){const l=N.source();try{let u=await v.post(e,s,{cancelToken:l.token});return((e,s)=>{for(var l in s||(s={}))r.call(s,l)&&t(e,l,s[l]);if(a)for(var l of a(s))o.call(s,l)&&t(e,l,s[l]);return e})({},u.data).data}catch(u){throw b(u)&&console.log("Request canceled",u.message),u}}axios;function y(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Vue.isVNode(e)}var h=Vue.defineComponent({name:"Login",setup(e,{slots:a}){const r=u(),o=n(),{t:t}=d({useScope:"global"}),v=Vue.ref(),N=Vue.reactive({username:"",password:"",agreed:!0}),b=Vue.reactive({user:[{required:!0,message:t("login.usernameTip"),trigger:"blur"}],password:[{required:!0,message:t("login.passwordTip"),trigger:"blur"}]});async function h(){var e,a;try{await v.value.validate(),console.log("values",Vue.toRaw(N)),await w("/api/user/login",Vue.toRaw(N)),o.push(null!=(a=null==(e=r.query)?void 0:e.redirect)?a:"/home")}catch(t){console.log("error",t)}}return()=>{let e,a,r;return Vue.createVNode(s,null,{default:()=>[Vue.createVNode("div",{class:l.outer},[Vue.createVNode("div",{class:l.padding},[Vue.createVNode("h3",null,[Vue.createTextVNode("China 2021 plus")])]),Vue.createVNode("div",{class:l.form},[Vue.createVNode("h1",null,[t("login.loginForm")]),Vue.createVNode(c,{ref:v,model:N,rules:b},{default:()=>[Vue.createVNode(c.Item,{name:"username"},{default:()=>[Vue.createVNode(i,{value:N.username,"onUpdate:value":e=>N.username=e,placeholder:t("login.username")},{prefix:()=>Vue.createVNode(p,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),Vue.createVNode(c.Item,{name:"password"},{default:()=>[Vue.createVNode(i,{type:"password",value:N.password,"onUpdate:value":e=>N.password=e,placeholder:t("login.password")},{prefix:()=>Vue.createVNode(V,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),Vue.createVNode(c.Item,{name:"agreed"},{default:()=>[Vue.createVNode(g,{checked:N.agreed,"onUpdate:checked":e=>N.agreed=e},{default:()=>[Vue.createVNode(m,{to:"/agreement"},y(e=t("login.agreeTip"))?e:{default:()=>[e]})]})]}),Vue.createVNode(c.Item,null,{default:()=>[Vue.createVNode(f,{type:"primary",block:!0,disabled:!N.agreed,onClick:h},y(a=t("login.login"))?a:{default:()=>[a]})]})]}),Vue.createVNode("p",{class:l.registTip},[Vue.createVNode(m,{to:"/signUp"},y(r=t("login.registTip"))?r:{default:()=>[r]})])]),Vue.createVNode("div",{class:l.padding},null)])]})}}});export default h;
