var e=Object.defineProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,r,t)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t;import{L as s,s as l}from"./index.module.ba4ef8ce.js";import{h as n,u,a as d,F as c,I as i,U as p,w as V,x as g,o as f,y as m}from"./vendor.7b3e9c73.js";axios.defaults.baseURL="/",axios.defaults.timeout=3e4,axios.defaults.headers.post["Content-Type"]="application/json";const v=axios.create();v.interceptors.response.use((e=>{var a;const r=e.data;return r.status||200===r.code?e:(alert(r.message||`Error ${r.code}`),Promise.reject(new Error(null!=(a=r.message)?a:`Error ${r.code}`)))}),(e=>{var a,r;const t=e.response;return t&&t.status&&t.data&&(t.status,alert(t.data.message)),Promise.reject(new Error(null!=(r=null==(a=null==t?void 0:t.data)?void 0:a.error)?r:"Network error"))}));const{CancelToken:N,isCancel:b}=axios;async function w(e,s){const l=N.source();let n=new FormData,u=!1;if(s)for(let a in s){let e=s[a];e.length&&e[0]instanceof File?(u=!0,e.forEach((e=>{n.append(a,e)}))):e instanceof File?(u=!0,n.append(a,e)):n.append(a,e)}let d=v;if(u){let e={"Content-Type":"multipart/form-data"};d=axios.create({headers:e,timeout:0})}try{let s=await d.post(e,n,{cancelToken:l.token});return((e,s)=>{for(var l in s||(s={}))r.call(s,l)&&o(e,l,s[l]);if(a)for(var l of a(s))t.call(s,l)&&o(e,l,s[l]);return e})({},s.data).data}catch(c){throw b(c)&&console.log("Request canceled",c.message),c}}axios;function y(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Vue.isVNode(e)}var h=Vue.defineComponent({name:"Login",setup(e,{slots:a}){const r=n(),t=u(),{t:o}=d({useScope:"global"}),v=Vue.ref(),N=Vue.reactive({user:"",password:"",agreed:!0}),b=Vue.reactive({user:[{required:!0,message:o("login.usernameTip"),trigger:"blur"}],password:[{required:!0,message:o("login.passwordTip"),trigger:"blur"}]});async function h(){var e,a;try{await v.value.validate(),console.log("values",Vue.toRaw(N)),await w("/api/app/h5/login",Vue.toRaw(N)),t.push(null!=(a=null==(e=r.query)?void 0:e.redirect)?a:"/home")}catch(o){console.log("error",o)}}return()=>{let e,a,r;return Vue.createVNode(s,null,{default:()=>[Vue.createVNode("div",{class:l.outer},[Vue.createVNode("div",{class:l.padding},[Vue.createVNode("h3",null,[Vue.createTextVNode("China 2021 plus")])]),Vue.createVNode("div",{class:l.form},[Vue.createVNode("h1",null,[o("login.loginForm")]),Vue.createVNode(c,{ref:v,model:N,rules:b},{default:()=>[Vue.createVNode(c.Item,{name:"user"},{default:()=>[Vue.createVNode(i,{value:N.user,"onUpdate:value":e=>N.user=e,placeholder:o("login.username")},{prefix:()=>Vue.createVNode(p,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),Vue.createVNode(c.Item,{name:"password"},{default:()=>[Vue.createVNode(i,{type:"password",value:N.password,"onUpdate:value":e=>N.password=e,placeholder:o("login.password")},{prefix:()=>Vue.createVNode(V,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),Vue.createVNode(c.Item,{name:"agreed"},{default:()=>[Vue.createVNode(g,{checked:N.agreed,"onUpdate:checked":e=>N.agreed=e},{default:()=>[Vue.createVNode(f,{to:"/agreement"},y(e=o("login.agreeTip"))?e:{default:()=>[e]})]})]}),Vue.createVNode(c.Item,null,{default:()=>[Vue.createVNode(m,{type:"primary",block:!0,disabled:!N.agreed,onClick:h},y(a=o("login.login"))?a:{default:()=>[a]})]})]}),Vue.createVNode("p",{class:l.registTip},[Vue.createVNode(f,{to:"/signUp"},y(r=o("login.registTip"))?r:{default:()=>[r]})])]),Vue.createVNode("div",{class:l.padding},null)])]})}}});export default h;
