import{a as k,u as x,d as j,L as D,U as E}from"./index.0d78e88c.js";import{u as b}from"./vue-i18n.0711e616.js";import{S as H}from"./Config.87ac60ee.js";import{I as N,e as O,B as A,G as B}from"./ant-design-vue.034afe85.js";import{d as g,k as e,u as h,l as $,o as L,c as T,i as Y,n as q}from"./@vue.fa05379c.js";import{p as _}from"./Image.f0a737d7.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./BlankGif.8ca146ab.js";const G="_chatList_lw0gu_1",R="_chatItem_lw0gu_1",V="_avata_lw0gu_12",P="_content_lw0gu_19",z="_time_lw0gu_23",J="_msg_lw0gu_29",W="_chatSection_lw0gu_43",F="_targetUserInfo_lw0gu_46",K="_info_lw0gu_57",Q="_chatMsgBox_lw0gu_61",X="_invite_lw0gu_69",Z="_invite_title_lw0gu_81",ee="_invite_content_lw0gu_84",te="_bubble_lw0gu_96",se="_left_lw0gu_110",ae="_right_lw0gu_125",ne="_sender_lw0gu_141";var a={chatList:G,chatItem:R,avata:V,content:P,time:z,msg:J,chatSection:W,targetUserInfo:F,info:K,chatMsgBox:Q,invite:X,invite_title:Z,invite_content:ee,bubble:te,left:se,right:ae,sender:ne},re=g({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(r){const{msg:i,selfBarCode:l}=r;return()=>e("div",{key:i.id,class:`${a.bubble} ${i.to_barcode===l?a.left:a.right}`},[e("p",null,[i.msgcontent])])}}),ie=g({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(r){const{t:i}=b(),{msg:l,targetUserName:t}=r;let o=JSON.parse(l.msgcontent);return()=>l.from_barcode===r.selfBarCode?e("div",{class:`pd_20 ${a.invite}`,key:l.id},[e("p",{class:a.invite_title},[i("myItb.chat.you_invite_attend"),h(" "),t]),e("div",{class:a.invite_content},[e("img",{src:_(l.from_HeadImageUrl),alt:""},null),e("img",{src:_(l.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${o.beginDate.substr(0,10)}`,e("br",null,null),`${o.beginDate.substr(11,5)} ~ ${o.endDate.substr(11,5)}`]),e("p",null,null)])])]):e("div",{class:`pd_20 ${a.invite}`,key:l.id},[e("p",{class:a.invite_title},[t,h(" "),i("myItb.chat.invite_you_attend")]),e("div",{class:a.invite_content},[e("img",{src:_(l.from_HeadImageUrl),alt:""},null),e("img",{src:_(l.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${o.beginDate.substr(0,10)}`,e("br",null,null),`${o.beginDate.substr(11,5)} ~ ${o.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function le(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Y(r)}var oe=g({name:"Chat",setup(){var n,I,U,S;const{t:r}=b(),{appStore:i}=x(),{authenStore:l}=k(),{chatStore:t}=j(),o=$(""),p=$(),d=l.user.barcode;L(async()=>{await t.getChattingMessages(t.targetUser.employee_id),f()});function f(){let u=p.value;u.scrollTop=u.scrollHeight}async function y(){o.value&&(await t.sendChattingMessage(o.value),o.value="",q(f))}function v(u){return u.map(c=>{if(c.msgtype<2)return e(re,{key:c.id,msg:c,selfBarCode:d},null);if(c.msgtype<6)return e(ie,{key:c.id,msg:c,targetUserName:s.name,selfBarCode:d},null);if(c.msgtype===6)return e("div",{key:c.id,class:`pd_20 ${a.invite}`},[h("\u540D\u7247")])})}let s=T({name:i.isEn?((n=t.targetUser)==null?void 0:n.firstname)+" "+((I=t.targetUser)==null?void 0:I.lastname):""+((U=t.targetUser)==null?void 0:U.lastname_cn)+((S=t.targetUser)==null?void 0:S.firstname_cn)});return()=>{var u,c,M,w,C;return e("section",{class:a.chatSection,key:(u=t.targetUser)==null?void 0:u.employee_id},[e("div",{class:a.targetUserInfo},[e("img",{class:a.avata,src:`${H}${(c=t.targetUser)==null?void 0:c.HeadImageUrl}`},null),e("div",{class:a.info},[e("h4",null,[s.name]),e("div",null,[i.isEn?(M=t.targetUser)==null?void 0:M.company:(w=t.targetUser)==null?void 0:w.company_cn]),e("div",null,[(C=t.targetUser)==null?void 0:C.job_title])])]),e("div",{ref:p,class:a.chatMsgBox},[t.chattingMsgs&&v(t.chattingMsgs)]),e("div",{class:a.sender},[e(N,{type:"text",value:o.value,"onUpdate:value":m=>o.value=m},{suffix:()=>{let m;return e(O,{style:{backgroundColor:"black",color:"white"},onClick:y},le(m=r("myItb.chat.send"))?m:{default:()=>[m]})}})])])}}}),ce=g({name:"MsgList",setup(){var v;const{t:r}=b(),{appStore:i}=x(),{authenStore:l}=k(),{chatStore:t}=j(),o=(v=l.user)==null?void 0:v.barcode;function p(s){return i.isEn?s.firstname+" "+s.lastname:s.lastname_cn+s.firstname_cn}L(()=>{t.chattingMsgs=t.targetUser=void 0,t.lastMessages?t.getLastMessages():t.refreshMsgList()});function d(s){let n={job_title:s.job_title,employee_id:s.barcode,HeadImageUrl:s.HeadImageUrl,firstname_cn:s.firstname_cn,firstname:s.firstname,lastname_cn:s.lastname_cn,lastname:s.lastname,company:s.company,company_cn:s.company_cn,IsOnline:0};t.chatWith(n)}function f(s){let n=s.last_message;if(n.msgtype===0)return e("span",null,[n.msgcontent]);if(n.msgtype===1)return e("span",null,[r("myItb.messages.reply_message")]);if(n.msgtype>1&&n.msgtype<6)return e("span",null,[r("myItb.messages.invite_message")]);if(n.msgtype===6)return e("span",null,[r("myItb.messages.card_message")])}function y(s){return s.length>0?s.map(n=>e("div",{key:n.barcode,class:a.chatItem,onClick:()=>{d(n)}},[e("img",{class:a.avata,src:_(n.HeadImageUrl),onClick:()=>{d(n)}},null),e("div",{class:a.content},[e("span",{class:a.time},[E(n.last_message.createdatetime,l.minutesOffset,"YYYY-MM-DD")]),e(A,{dot:n.last_message.from_barcode!=o&&n.last_message.status===0},{default:()=>[e("h4",null,[p(n),h(" ")])]}),e("div",{class:a.msg},[f(n)])])])):e(B,{image:B.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:a.chatList},[t.lastMessages?y(t.lastMessages):e(D,null,null)])}}),Oe=g({name:"ChatSection",setup(){const{t:r}=b(),{chatStore:i}=j();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{i.chattingMsgs=i.targetUser=void 0,i.viewState=0}},[r("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[i.viewState===0?e(ce,null,null):e(oe,null,null)])])}});export{Oe as default};
