import{c as e,u as a,b as t,L as s,U as n}from"./index.247a591d.js";import{u as r}from"./vue-i18n.bbad715b.js";import{I as l,l as o,B as i,E as c}from"./ant-design-vue.caf0e0b9.js";import{a2 as d,a0 as m,k as u,aq as v,ag as _,aj as p,al as g}from"./@vue.5723de44.js";import"./vue-router.0532eeed.js";import"./moment.29305b8e.js";import"./@ant-design.503097a2.js";import"./@ctrl.2e36ce53.js";import"./nprogress.3e43c680.js";import"./axios.a57df465.js";import"./@babel.dc475c8c.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.60ec16aa.js";import"./warning.4abaefa0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.c2b61631.js";import"./source-map.3671d69c.js";import"./vue.3a1030aa.js";var f="_chatList_1vd6n_1",b="_chatItem_1vd6n_1",j="_avata_1vd6n_12",h="_content_1vd6n_19",y="_time_1vd6n_23",M="_msg_1vd6n_29",U="_chatSection_1vd6n_43",S="_targetUserInfo_1vd6n_46",C="_info_1vd6n_56",I="_chatMsgBox_1vd6n_60",k="_bubble_1vd6n_68",E="_left_1vd6n_82",w="_right_1vd6n_97",x="_sender_1vd6n_113",L=d({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(e){const{msg:a,selfBarCode:t}=e;return()=>m("div",{key:a.id,class:`${k} ${a.to_barcode===t?E:w}`},[m("p",null,[a.msgcontent])])}});var B=d({name:"Chat",setup(){const{t:s}=r(),{appStore:n}=a(),{authenStore:i}=e(),{chatStore:c}=t(),d=u(""),g=u(),f=i.user.barcode;function b(){let e=g.value;e.scrollTop=e.scrollHeight}async function h(){d.value&&(await c.sendChattingMessage(d.value),d.value="",p(b))}return v((async()=>{await c.getChattingMessages(f),b()})),()=>{var e,a,t,r,i,u,v,p,b;return m("section",{class:U},[m("div",{class:S},[m("img",{class:j,src:null==(e=c.targetUser)?void 0:e.HeadImageUrl},null),m("div",{class:C},[m("h4",null,[n.isEn?(null==(a=c.targetUser)?void 0:a.firstname)+" "+(null==(t=c.targetUser)?void 0:t.lastname):""+(null==(r=c.targetUser)?void 0:r.lastname_cn)+(null==(i=c.targetUser)?void 0:i.firstname_cn)]),m("div",null,[null==(u=c.targetUser)?void 0:u.job_title]),m("div",null,[n.isEn?null==(v=c.targetUser)?void 0:v.company:null==(p=c.targetUser)?void 0:p.company_cn])])]),m("div",{ref:g,class:I},[null==(b=c.chattingMsgs)?void 0:b.map((e=>m(L,{key:e.id,msg:e,selfBarCode:f},null)))]),m("div",{class:x},[m(l,{type:"text",value:d.value,"onUpdate:value":e=>d.value=e},{suffix:()=>{let e;return m(o,{style:{backgroundColor:"black",color:"white"},onClick:h},"function"==typeof(a=e=s("myItb.chat.send"))||"[object Object]"===Object.prototype.toString.call(a)&&!_(a)?e:{default:()=>[e]});var a}})])])}}}),H=d({name:"MsgList",setup(){var r;const{appStore:l}=a(),{authenStore:o}=e(),{chatStore:d}=t(),u=null==(r=o.user)?void 0:r.barcode;function v(e){let a={job_title:e.job_title,employee_id:e.barcode,HeadImageUrl:e.HeadImageUrl,firstname_cn:e.firstname_cn,firstname:e.firstname,lastname_cn:e.lastname_cn,lastname:e.lastname,company:e.company,company_cn:e.company_cn};d.chatWith(a)}return g((()=>{d.lastMessages?d.getLastMessages():d.refreshMsgList()})),()=>{return m("div",{class:f},[d.lastMessages?(e=d.lastMessages,e.length>0?e.map((e=>m("div",{key:e.barcode,class:b},[m("img",{class:j,src:e.HeadImageUrl,onClick:()=>{v(e)}},null),m("div",{class:h},[m("span",{class:y},[n(e.last_message.createdatetime,o.minutesOffset,"YYYY-MM-DD")]),m(i,{dot:e.last_message.from_barcode!=u&&0===e.last_message.status},{default:()=>[m("h4",{onClick:()=>{v(e)}},[l.isEn?e.firstname+" "+e.lastname:e.lastname_cn+e.firstname_cn," "])]}),m("div",{class:M},[e.last_message.msgcontent])])]))):m(c,{image:c.PRESENTED_IMAGE_SIMPLE},null)):m(s,null,null)]);var e}}}),O=d({name:"ChatSection",setup(){const{t:e}=r(),{chatStore:a}=t();return()=>m("div",{class:"ant-card ant-card-bordered"},[m("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[m("div",{class:"ant-card-head-wrapper"},[m("div",{class:"ant-card-head-title"},[e("myItb.dockIcons.chat")])])]),m("div",{class:"ant-card-body",style:"padding: 2px;"},[0===a.viewState?m(H,null,null):m(B,null,null)])])}});export default O;
