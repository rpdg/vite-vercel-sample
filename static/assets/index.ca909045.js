import{s as m,L as F,a as W}from"./index.ef6b5751.js";import{u as y}from"./vue-i18n.8989ea2a.js";import{a as I,u as P,d as j}from"./vue-router.65bc85cf.js";import{a as x}from"./index.156122b3.js";import{F as n,I as f,r as T,g as S,n as q}from"./ant-design-vue.45bb77f4.js";import{x as B,J as L,M,K as $}from"./@ant-design.b29a0759.js";import{d as w,l as C,c as b,k as e,i as k,B as G,I as H}from"./@vue.f0f90a02.js";import{B as N}from"./BlankGif.8ca146ab.js";import"./HomeStore.2474d539.js";import"./@intlify.35d5f340.js";import"./source-map.3671d69c.js";import"./vue.8bc7d658.js";import"./moment.29305b8e.js";import"./nprogress.8b9ed5b7.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@ctrl.2e36ce53.js";function _(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!k(r)}var z=w({name:"Login_PasswordForm",setup(){const{authenStore:r}=x(),u=I(),g=P(),{t}=y({useScope:"global"}),p=C(),o=b({username:"",password:"",agreed:!0}),v=b({username:[{required:!0,message:t("login.usernameTip"),trigger:"change"}],password:[{required:!0,message:t("login.passwordTip"),trigger:"change"}]});async function h(){var a,c;try{await p.value.validate(),await r.loginWithPassword(G(o)),g.push((c=(a=u.query)==null?void 0:a.redirect)!=null?c:"/home")}catch(d){console.log("error",d)}}return()=>{let a,c;return e(n,{ref:p,model:o,rules:v},{default:()=>[e(n.Item,{name:"username"},{default:()=>[e(f,{value:o.username,"onUpdate:value":d=>o.username=d,placeholder:t("login.username")},{prefix:()=>e(B,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(n.Item,{name:"password"},{default:()=>[e(f,{type:"password",value:o.password,"onUpdate:value":d=>o.password=d,placeholder:t("login.password")},{prefix:()=>e(L,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(n.Item,{name:"agreed"},{default:()=>[e(T,{checked:o.agreed,"onUpdate:checked":d=>o.agreed=d},{default:()=>[e(j,{to:"/agreement"},_(a=t("login.agreeTip"))?a:{default:()=>[a]})]})]}),e(n.Item,null,{default:()=>[e(S,{type:"primary",block:!0,disabled:!o.agreed,loading:r.loading,onClick:h},_(c=t("login.login"))?c:{default:()=>[c]})]})]})}}});function A(r){return/^1[3456789]\d{9}$/.test(r)}function R(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!k(r)}var J=w({name:"Login_PasswordForm",setup(){const{authenStore:r}=x(),u=I(),g=P(),{t}=y({useScope:"global"});H(()=>{r.getImgCode()});const p=C(),o=b({action:"sms",mobile:"",graphVerifyCode:"",verifyCode:"",agreed:!0,sendingSms:!1}),v=t("myItb.chat.send"),h="59",a=C(v);let c=async(i,l)=>A(l)?Promise.resolve():Promise.reject(t("login.mobileTip2")),d=async(i,l)=>o.action==="login"&&l===""?Promise.reject(t("login.smsCodeTip")):Promise.resolve();const O=b({mobile:[{required:!0,message:t("login.mobileTip"),trigger:"change"},{validator:c,trigger:"change"}],graphVerifyCode:[{required:!0,message:t("login.graphicCodeTip"),trigger:"change"}],verifyCode:[{validator:d,trigger:"change"}]});async function U(){o.action="sms";try{await p.value.validate(),o.sendingSms=!0,a.value=h;let i=setInterval(function(){~~a.value-1<1?(clearInterval(i),o.sendingSms=!1,a.value=v):a.value=~~a.value-1},1e3);await r.sendSmsCode(o.mobile,o.graphVerifyCode)&&q.success({message:t("login.smsSendSuccess")})}catch(i){console.log("error",i)}}async function V(){var i,l;o.action="login";try{await p.value.validate(),await r.loginWithSms(o.mobile,o.verifyCode),g.push((l=(i=u.query)==null?void 0:i.redirect)!=null?l:"/home")}catch(s){console.log("error",s)}}return()=>{let i,l;return e(n,{ref:p,model:o,rules:O},{default:()=>[e(n.Item,{name:"mobile",validateFirst:!0},{default:()=>[e(f,{value:o.mobile,"onUpdate:value":s=>o.mobile=s,placeholder:t("login.mobile")},{prefix:()=>e(M,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(n.Item,{name:"graphVerifyCode"},{default:()=>[e(f,{value:o.graphVerifyCode,"onUpdate:value":s=>o.graphVerifyCode=s,placeholder:t("login.graphicCode")},{prefix:()=>e($,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>{var s;return e("img",{src:((s=r.graphicRes)==null?void 0:s.graphVerifyCodeImg)||N},null)}})]}),e(n.Item,{name:"verifyCode"},{default:()=>[e(f,{value:o.verifyCode,"onUpdate:value":s=>o.verifyCode=s,placeholder:t("login.smsCode")},{prefix:()=>e(L,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>e(S,{style:{backgroundColor:"black",color:"white"},onClick:U,disabled:o.sendingSms},{default:()=>[a.value]})})]}),e(n.Item,{name:"agreed"},{default:()=>[e(T,{checked:o.agreed,"onUpdate:checked":s=>o.agreed=s},{default:()=>[e(j,{to:"/agreement"},R(i=t("login.agreeTip"))?i:{default:()=>[i]})]})]}),e(n.Item,null,{default:()=>[e(S,{type:"primary",block:!0,disabled:!o.agreed,loading:r.loading,onClick:V},R(l=t("login.login"))?l:{default:()=>[l]})]})]})}}});function K(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!k(r)}var Se=w({name:"Login",setup(){const{t:r}=y({useScope:"global"}),u=b({loginWithPassword:!0});function g(t){u.loginWithPassword=t}return()=>{let t;return e(W,null,{default:()=>[e("div",{class:m.outer},[e("div",{class:m.padding},[e(F,null,null)]),e("div",{class:m.form},[e("h1",null,[r("login.loginForm")]),e("div",{class:m.tabs},[e("div",{class:u.loginWithPassword?m.curTab:"",onClick:()=>{g(!0)}},[e("span",null,[r("login.passwordLogin")])]),e("div",{class:u.loginWithPassword?"":m.curTab,onClick:()=>{g(!1)}},[e("span",null,[r("login.smsLogin")])])]),u.loginWithPassword?e(z,null,null):e(J,null,null)]),e("div",{class:m.padding},[e("p",{class:m.registTip},[e(j,{to:"/signUp"},K(t=r("login.registTip"))?t:{default:()=>[t]})])])])]})}}});export{Se as default};
