import{a as S,u as I,c as _,L as x,U as L}from"./index.f18cc009.js";import{u as C}from"./vue-i18n.0711e616.js";import{I as k,i as E,B as w,G as U}from"./ant-design-vue.b491a4ce.js";import{d as p,k as t,l as B,o as H,i as O,n as Y,I as A}from"./@vue.fa05379c.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";const D="_chatList_1vd6n_1",N="_chatItem_1vd6n_1",R="_avata_1vd6n_12",T="_content_1vd6n_19",q="_time_1vd6n_23",G="_msg_1vd6n_29",P="_chatSection_1vd6n_43",V="_targetUserInfo_1vd6n_46",$="_info_1vd6n_56",z="_chatMsgBox_1vd6n_60",W="_bubble_1vd6n_68",F="_left_1vd6n_82",J="_right_1vd6n_97",K="_sender_1vd6n_113";var s={chatList:D,chatItem:N,avata:R,content:T,time:q,msg:G,chatSection:P,targetUserInfo:V,info:$,chatMsgBox:z,bubble:W,left:F,right:J,sender:K},Q=p({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(o){const{msg:r,selfBarCode:c}=o;return()=>t("div",{key:r.id,class:`${s.bubble} ${r.to_barcode===c?s.left:s.right}`},[t("p",null,[r.msgcontent])])}});function X(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!O(o)}var Z=p({name:"Chat",setup(){const{t:o}=C(),{appStore:r}=I(),{authenStore:c}=S(),{chatStore:n}=_(),i=B(""),u=B(),d=c.user.barcode;H(async()=>{await n.getChattingMessages(d),a()});function a(){let m=u.value;m.scrollTop=m.scrollHeight}async function e(){i.value&&(await n.sendChattingMessage(i.value),i.value="",Y(a))}return()=>{var m,f,v,g,h,b,j,y,M;return t("section",{class:s.chatSection},[t("div",{class:s.targetUserInfo},[t("img",{class:s.avata,src:(m=n.targetUser)==null?void 0:m.HeadImageUrl},null),t("div",{class:s.info},[t("h4",null,[r.isEn?((f=n.targetUser)==null?void 0:f.firstname)+" "+((v=n.targetUser)==null?void 0:v.lastname):""+((g=n.targetUser)==null?void 0:g.lastname_cn)+((h=n.targetUser)==null?void 0:h.firstname_cn)]),t("div",null,[(b=n.targetUser)==null?void 0:b.job_title]),t("div",null,[r.isEn?(j=n.targetUser)==null?void 0:j.company:(y=n.targetUser)==null?void 0:y.company_cn])])]),t("div",{ref:u,class:s.chatMsgBox},[(M=n.chattingMsgs)==null?void 0:M.map(l=>t(Q,{key:l.id,msg:l,selfBarCode:d},null))]),t("div",{class:s.sender},[t(k,{type:"text",value:i.value,"onUpdate:value":l=>i.value=l},{suffix:()=>{let l;return t(E,{style:{backgroundColor:"black",color:"white"},onClick:e},X(l=o("myItb.chat.send"))?l:{default:()=>[l]})}})])])}}}),tt=p({name:"MsgList",setup(){var d;const{appStore:o}=I(),{authenStore:r}=S(),{chatStore:c}=_(),n=(d=r.user)==null?void 0:d.barcode;A(()=>{c.lastMessages?c.getLastMessages():c.refreshMsgList()});function i(a){let e={job_title:a.job_title,employee_id:a.barcode,HeadImageUrl:a.HeadImageUrl,firstname_cn:a.firstname_cn,firstname:a.firstname,lastname_cn:a.lastname_cn,lastname:a.lastname,company:a.company,company_cn:a.company_cn};c.chatWith(e)}function u(a){return a.length>0?a.map(e=>t("div",{key:e.barcode,class:s.chatItem},[t("img",{class:s.avata,src:e.HeadImageUrl,onClick:()=>{i(e)}},null),t("div",{class:s.content},[t("span",{class:s.time},[L(e.last_message.createdatetime,r.minutesOffset,"YYYY-MM-DD")]),t(w,{dot:e.last_message.from_barcode!=n&&e.last_message.status===0},{default:()=>[t("h4",{onClick:()=>{i(e)}},[o.isEn?e.firstname+" "+e.lastname:e.lastname_cn+e.firstname_cn," "])]}),t("div",{class:s.msg},[e.last_message.msgcontent])])])):t(U,{image:U.PRESENTED_IMAGE_SIMPLE},null)}return()=>t("div",{class:s.chatList},[c.lastMessages?u(c.lastMessages):t(x,null,null)])}}),Ct=p({name:"ChatSection",setup(){const{t:o}=C(),{chatStore:r}=_();return()=>t("div",{class:"ant-card ant-card-bordered"},[t("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[t("div",{class:"ant-card-head-wrapper"},[t("div",{class:"ant-card-head-title"},[o("myItb.dockIcons.chat")])])]),t("div",{class:"ant-card-body",style:"padding: 2px;"},[r.viewState===0?t(tt,null,null):t(Z,null,null)])])}});export{Ct as default};
