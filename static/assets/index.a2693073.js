import{B as x}from"./BlankGif.8ca146ab.js";import{u as V,a as R}from"./index.bbac38a9.js";import{v as _}from"./@rpdg.dab4d1a7.js";import{F as l,I as d,e as m,u as P,p as T}from"./ant-design-vue.14644436.js";import{u as w}from"./vue-i18n.532c4af8.js";import{a as B,u as F,d as O}from"./vue-router.8e73f157.js";import{M as L,J as M,H as U}from"./@ant-design.4b470cc8.js";import{d as q,I as A,l as g,c as f,k as o,i as E}from"./@vue.7a36ac42.js";function p(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!E(s)}var Q=q({name:"Login_SmsForm",setup(){const{authenStore:s}=V(),{appStore:v}=R(),b=B(),h=F(),{t}=w({useScope:"global"});A(()=>{s.getImgCode()});const u=g(),e=f({action:"sms",mobile:"",graphVerifyCode:"",verifyCode:"",agreed:!0,sendingSms:!1}),c=t("myItb.chat.send"),y="59",n=g(c);let C=async(r,i)=>_(i)?Promise.resolve():Promise.reject(t("login.mobileTip2")),S=async(r,i)=>e.action==="login"&&i===""?Promise.reject(t("login.smsCodeTip")):Promise.resolve();const k=f({mobile:[{required:!0,message:t("login.mobileTip"),trigger:"change"},{validator:C,trigger:"change"}],graphVerifyCode:[{required:!0,message:t("login.graphicCodeTip"),trigger:"change"}],verifyCode:[{validator:S,trigger:"change"}]});async function j(){e.action="sms";try{await u.value.validate(),e.sendingSms=!0,n.value=y;let r=setInterval(function(){~~n.value-1<1?(clearInterval(r),e.sendingSms=!1,n.value=c):n.value=~~n.value-1},1e3);await s.sendSmsCode(e.mobile,e.graphVerifyCode)&&T.success({message:t("login.smsSendSuccess")})}catch(r){console.log("error",r)}}async function I(){var r,i;e.action="login";try{await u.value.validate(),await s.loginWithSms(e.mobile,e.verifyCode),h.push((i=(r=b.query)==null?void 0:r.redirect)!=null?i:"/home")}catch(a){console.log("error",a)}}return()=>{let r,i;return o(l,{ref:u,model:e,rules:k},{default:()=>[o(l.Item,{name:"mobile",validateFirst:!0},{default:()=>[o(d,{value:e.mobile,"onUpdate:value":a=>e.mobile=a,placeholder:t("login.mobile")},{prefix:()=>o(L,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),o(l.Item,{name:"graphVerifyCode"},{default:()=>[o(d,{value:e.graphVerifyCode,"onUpdate:value":a=>e.graphVerifyCode=a,placeholder:t("login.graphicCode")},{prefix:()=>o(M,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>{var a;return o("img",{src:((a=s.graphicRes)==null?void 0:a.graphVerifyCodeImg)||x},null)}})]}),o(l.Item,{name:"verifyCode"},{default:()=>[o(d,{value:e.verifyCode,"onUpdate:value":a=>e.verifyCode=a,placeholder:t("login.smsCode")},{prefix:()=>o(U,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>o(m,{style:{backgroundColor:"black",color:"white"},onClick:j,disabled:e.sendingSms},{default:()=>[n.value]})})]}),o(l.Item,{name:"agreed"},{default:()=>[o(P,{checked:e.agreed,"onUpdate:checked":a=>e.agreed=a},{default:()=>[o(O,{to:v.isEn?"/agreementEn":"/agreement"},p(r=t("login.agreeTip"))?r:{default:()=>[r]})]})]}),o(l.Item,null,{default:()=>[o(m,{type:"primary",block:!0,disabled:!e.agreed,loading:s.loading,onClick:I},p(i=t("login.login"))?i:{default:()=>[i]})]})]})}}});export{Q as S};
