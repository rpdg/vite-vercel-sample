import{a as k,u as x,d as h,L as N,U as $}from"./index.1ef6329d.js";import{u as b}from"./vue-i18n.0711e616.js";import{S as D}from"./Config.87ac60ee.js";import{I as H,g as O,B as A,G as B}from"./ant-design-vue.0721aa65.js";import{d as p,k as e,u as d,l as L,o as E,c as T,i as Y,n as q}from"./@vue.fa05379c.js";import{p as y}from"./Image.f0a737d7.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./BlankGif.8ca146ab.js";const G="_chatList_lw0gu_1",R="_chatItem_lw0gu_1",V="_avata_lw0gu_12",P="_content_lw0gu_19",z="_time_lw0gu_23",J="_msg_lw0gu_29",W="_chatSection_lw0gu_43",F="_targetUserInfo_lw0gu_46",K="_info_lw0gu_57",Q="_chatMsgBox_lw0gu_61",X="_invite_lw0gu_69",Z="_invite_title_lw0gu_81",ee="_invite_content_lw0gu_84",te="_bubble_lw0gu_96",se="_left_lw0gu_110",ae="_right_lw0gu_125",ne="_sender_lw0gu_141";var a={chatList:G,chatItem:R,avata:V,content:P,time:z,msg:J,chatSection:W,targetUserInfo:F,info:K,chatMsgBox:Q,invite:X,invite_title:Z,invite_content:ee,bubble:te,left:se,right:ae,sender:ne},re=p({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(o){const{msg:i,selfBarCode:r}=o;return()=>e("div",{key:i.id,class:`${a.bubble} ${i.to_barcode===r?a.left:a.right}`},[e("p",null,[i.msgcontent])])}}),ie=p({props:{msg:{type:Object,required:!0},targetUserName:String},setup(o){const{t:i}=b(),{msg:r,targetUserName:n}=o;let l=JSON.parse(r.msgcontent);return()=>e("div",{class:`pd_20 ${a.invite}`,key:r.id},[e("p",{class:a.invite_title},[n,d(" "),i("myItb.chat.invite_you_attend")]),e("div",{class:a.invite_content},[e("img",{src:y(r.from_HeadImageUrl),alt:""},null),e("img",{src:y(r.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${l.beginDate.substr(0,10)}`,e("br",null,null),`${l.beginDate.substr(11,5)} ~ ${l.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function oe(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Y(o)}var le=p({name:"Chat",setup(){var j,U,M,S;const{t:o}=b(),{appStore:i}=x(),{authenStore:r}=k(),{chatStore:n}=h(),l=L(""),m=L(),v=r.user.barcode;E(async()=>{await n.getChattingMessages(n.targetUser.employee_id),_()});function _(){let u=m.value;u.scrollTop=u.scrollHeight}async function f(){l.value&&(await n.sendChattingMessage(l.value),l.value="",q(_))}function t(u){return u.map(c=>{if(c.msgtype<2)return e(re,{key:c.id,msg:c,selfBarCode:v},null);if(c.msgtype<6)return e(ie,{msg:c,targetUserName:s.name,key:c.id},null);if(c.msgtype===6)return e("div",{class:`pd_20 ${a.invite}`},[d("\u540D\u7247")])})}let s=T({name:i.isEn?((j=n.targetUser)==null?void 0:j.firstname)+" "+((U=n.targetUser)==null?void 0:U.lastname):""+((M=n.targetUser)==null?void 0:M.lastname_cn)+((S=n.targetUser)==null?void 0:S.firstname_cn)});return()=>{var u,c,I,w,C;return e("section",{class:a.chatSection,key:(u=n.targetUser)==null?void 0:u.employee_id},[e("div",{class:a.targetUserInfo},[e("img",{class:a.avata,src:`${D}${(c=n.targetUser)==null?void 0:c.HeadImageUrl}`},null),e("div",{class:a.info},[e("h4",null,[s.name]),e("div",null,[i.isEn?(I=n.targetUser)==null?void 0:I.company:(w=n.targetUser)==null?void 0:w.company_cn]),e("div",null,[(C=n.targetUser)==null?void 0:C.job_title])])]),e("div",{ref:m,class:a.chatMsgBox},[n.chattingMsgs&&t(n.chattingMsgs)]),e("div",{class:a.sender},[e(H,{type:"text",value:l.value,"onUpdate:value":g=>l.value=g},{suffix:()=>{let g;return e(O,{style:{backgroundColor:"black",color:"white"},onClick:f},oe(g=o("myItb.chat.send"))?g:{default:()=>[g]})}})])])}}}),ce=p({name:"MsgList",setup(){var f;const{appStore:o}=x(),{authenStore:i}=k(),{chatStore:r}=h(),n=(f=i.user)==null?void 0:f.barcode;function l(t){return o.isEn?t.firstname+" "+t.lastname:t.lastname_cn+t.firstname_cn}E(()=>{r.chattingMsgs=r.targetUser=void 0,r.lastMessages?r.getLastMessages():r.refreshMsgList()});function m(t){let s={job_title:t.job_title,employee_id:t.barcode,HeadImageUrl:t.HeadImageUrl,firstname_cn:t.firstname_cn,firstname:t.firstname,lastname_cn:t.lastname_cn,lastname:t.lastname,company:t.company,company_cn:t.company_cn,IsOnline:0};r.chatWith(s)}function v(t){let s=t.last_message;if(s.msgtype===0)return e("span",null,[s.msgcontent]);if(s.msgtype===1)return e("span",null,[d("replied you")]);if(s.msgtype>1&&s.msgtype<6)return e("span",null,[d("invite you")]);if(s.msgtype===6)return e("span",null,[d("ask your business card")])}function _(t){return t.length>0?t.map(s=>e("div",{key:s.barcode,class:a.chatItem,onClick:()=>{m(s)}},[e("img",{class:a.avata,src:y(s.HeadImageUrl),onClick:()=>{m(s)}},null),e("div",{class:a.content},[e("span",{class:a.time},[$(s.last_message.createdatetime,i.minutesOffset,"YYYY-MM-DD")]),e(A,{dot:s.last_message.from_barcode!=n&&s.last_message.status===0},{default:()=>[e("h4",null,[l(s),d(" ")])]}),e("div",{class:a.msg},[v(s)])])])):e(B,{image:B.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:a.chatList},[r.lastMessages?_(r.lastMessages):e(N,null,null)])}}),Oe=p({name:"ChatSection",setup(){const{t:o}=b(),{chatStore:i}=h();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{i.chattingMsgs=i.targetUser=void 0,i.viewState=0}},[o("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[i.viewState===0?e(ce,null,null):e(le,null,null)])])}});export{Oe as default};
