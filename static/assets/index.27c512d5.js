import{u as x,a as B,d as j,L as w,U as E}from"./index.dfc4aa1c.js";import{u as b}from"./vue-i18n.0711e616.js";import{S as H}from"./Config.87ac60ee.js";import{I as N,e as O,B as A,G as $}from"./ant-design-vue.034afe85.js";import{d as g,k as e,u as h,l as L,o as D,c as T,i as Y,n as q}from"./@vue.fa05379c.js";import{p as _}from"./Image.f0a737d7.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.19d3e859.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./BlankGif.8ca146ab.js";const G="_chatList_lgocs_1",R="_chatItem_lgocs_1",V="_avata_lgocs_12",P="_content_lgocs_19",z="_time_lgocs_23",J="_msg_lgocs_29",W="_chatSection_lgocs_43",F="_targetUserInfo_lgocs_46",K="_info_lgocs_57",Q="_chatMsgBox_lgocs_61",X="_invite_lgocs_69",Z="_fromMe_lgocs_81",ee="_invite_title_lgocs_84",te="_invite_content_lgocs_87",se="_bubble_lgocs_99",ae="_left_lgocs_113",ne="_right_lgocs_128",re="_sender_lgocs_144";var s={chatList:G,chatItem:R,avata:V,content:P,time:z,msg:J,chatSection:W,targetUserInfo:F,info:K,chatMsgBox:Q,invite:X,fromMe:Z,invite_title:ee,invite_content:te,bubble:se,left:ae,right:ne,sender:re},oe=g({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(r){const{msg:o,selfBarCode:i}=r;return()=>e("div",{key:o.id,class:`${s.bubble} ${o.to_barcode===i?s.left:s.right}`},[e("p",null,[o.msgcontent])])}}),ie=g({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(r){const{t:o}=b(),{msg:i,targetUserName:t}=r;let l=JSON.parse(i.msgcontent);return()=>i.from_barcode===r.selfBarCode?e("div",{class:`pd_20 ${s.invite} ${s.fromMe}`,key:i.id},[e("p",{class:s.invite_title},[o("myItb.chat.you_invite_attend"),h(" "),t]),e("div",{class:s.invite_content},[e("img",{src:_(i.from_HeadImageUrl),alt:""},null),e("img",{src:_(i.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${l.beginDate.substr(0,10)}`,e("br",null,null),`${l.beginDate.substr(11,5)} ~ ${l.endDate.substr(11,5)}`]),e("p",null,null)])])]):e("div",{class:`pd_20 ${s.invite}`,key:i.id},[e("p",{class:s.invite_title},[t,h(" "),o("myItb.chat.invite_you_attend")]),e("div",{class:s.invite_content},[e("img",{src:_(i.from_HeadImageUrl),alt:""},null),e("img",{src:_(i.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${l.beginDate.substr(0,10)}`,e("br",null,null),`${l.beginDate.substr(11,5)} ~ ${l.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function le(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Y(r)}var ce=g({name:"Chat",setup(){var n,I,M,U;const{t:r}=b(),{appStore:o}=B(),{authenStore:i}=x(),{chatStore:t}=j(),l=L(""),p=L(),m=i.user.barcode;D(async()=>{t.targetUser&&(await t.getChattingMessages(t.targetUser.employee_id),f())});function f(){let d=p.value;d.scrollTop=d.scrollHeight}async function y(){l.value&&(await t.sendChattingMessage(l.value),l.value="",q(f))}function v(d){return d.map(c=>{if(c.msgtype<2)return e(oe,{key:c.id,msg:c,selfBarCode:m},null);if(c.msgtype<6)return e(ie,{key:c.id,msg:c,targetUserName:a.name,selfBarCode:m},null);if(c.msgtype===6)return e("div",{key:c.id,class:`pd_20 ${s.invite}`},[h("\u540D\u7247")])})}let a=T({name:o.isEn?((n=t.targetUser)==null?void 0:n.firstname)+" "+((I=t.targetUser)==null?void 0:I.lastname):""+((M=t.targetUser)==null?void 0:M.lastname_cn)+((U=t.targetUser)==null?void 0:U.firstname_cn)});return()=>{var d,c,S,C,k;return e("section",{class:s.chatSection,key:(d=t.targetUser)==null?void 0:d.employee_id},[e("div",{class:s.targetUserInfo},[e("img",{class:s.avata,src:`${H}${(c=t.targetUser)==null?void 0:c.HeadImageUrl}`},null),e("div",{class:s.info},[e("h4",null,[a.name]),e("div",null,[o.isEn?(S=t.targetUser)==null?void 0:S.company:(C=t.targetUser)==null?void 0:C.company_cn]),e("div",null,[(k=t.targetUser)==null?void 0:k.job_title])])]),e("div",{ref:p,class:s.chatMsgBox},[t.chattingMsgs&&v(t.chattingMsgs)]),e("div",{class:s.sender},[e(N,{type:"text",value:l.value,"onUpdate:value":u=>l.value=u},{suffix:()=>{let u;return e(O,{style:{backgroundColor:"black",color:"white"},onClick:y},le(u=r("myItb.chat.send"))?u:{default:()=>[u]})}})])])}}}),de=g({name:"MsgList",setup(){var v;const{t:r}=b(),{appStore:o}=B(),{authenStore:i}=x(),{chatStore:t}=j(),l=(v=i.user)==null?void 0:v.barcode;function p(a){return o.isEn?a.firstname+" "+a.lastname:a.lastname_cn+a.firstname_cn}D(()=>{t.chattingMsgs=t.targetUser=void 0,t.lastMessages?t.getLastMessages():t.refreshMsgList()});function m(a){let n={job_title:a.job_title,employee_id:a.barcode,HeadImageUrl:a.HeadImageUrl,firstname_cn:a.firstname_cn,firstname:a.firstname,lastname_cn:a.lastname_cn,lastname:a.lastname,company:a.company,company_cn:a.company_cn,IsOnline:0};t.chatWith(n)}function f(a){let n=a.last_message;if(n.msgtype===0)return e("span",null,[n.msgcontent]);if(n.msgtype===1)return e("span",null,[r("myItb.messages.reply_message")]);if(n.msgtype>1&&n.msgtype<6)return e("span",null,[r("myItb.messages.invite_message")]);if(n.msgtype===6)return e("span",null,[r("myItb.messages.card_message")])}function y(a){return a.length>0?a.map(n=>e("div",{key:n.barcode,class:s.chatItem,onClick:()=>{m(n)}},[e("img",{class:s.avata,src:_(n.HeadImageUrl),onClick:()=>{m(n)}},null),e("div",{class:s.content},[e("span",{class:s.time},[E(n.last_message.createdatetime,i.minutesOffset,"YYYY-MM-DD")]),e(A,{dot:n.last_message.from_barcode!=l&&n.last_message.status===0},{default:()=>[e("h4",null,[p(n),h(" ")])]}),e("div",{class:s.msg},[f(n)])])])):e($,{image:$.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:s.chatList},[t.lastMessages?y(t.lastMessages):e(w,null,null)])}}),Ae=g({name:"ChatSection",setup(){const{t:r}=b(),{chatStore:o}=j();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{o.chattingMsgs=o.targetUser=void 0,o.viewState=0}},[r("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[o.viewState===0?e(de,null,null):e(ce,null,null)])])}});export{Ae as default};
