var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(e,a,n)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,r=(t,e,a)=>(i(t,"symbol"!=typeof e?e+"":e,a),a);import{B as o,p as l,g as s,l as c}from"./index.ffebe535.js";import{u as p}from"./vue-i18n.bbad715b.js";import{s as u}from"./index.module.08f1abaa.js";import{s as d,T as m,F as g,m as h,n as y,I as v,l as f,t as b}from"./ant-design-vue.caf0e0b9.js";import{a2 as I,a0 as j,k as x,r as w,c as S,ag as C,I as A,$ as B,t as L,al as P}from"./@vue.5723de44.js";import"./vue-router.0532eeed.js";import"./moment.29305b8e.js";import"./@ant-design.503097a2.js";import"./@ctrl.2e36ce53.js";import"./nprogress.3e43c680.js";import"./axios.a57df465.js";import"./@babel.dc475c8c.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.60ec16aa.js";import"./warning.4abaefa0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.c2b61631.js";import"./source-map.3671d69c.js";import"./vue.3a1030aa.js";var q=Object.defineProperty,O=Object.getOwnPropertyDescriptor,$=(t,e,a,n)=>{for(var i,r=n>1?void 0:n?O(e,a):e,o=t.length-1;o>=0;o--)(i=t[o])&&(r=(n?i(e,a,r):i(r))||r);return n&&r&&q(e,a,r),r};class R extends o{constructor(){super(),r(this,"reserveType","catering"),r(this,"userInfo"),r(this,"currentLng"),r(this,"serviceList"),r(this,"sumApplyPrice",0),r(this,"appliedList"),r(this,"sumAppliedPrice",0),r(this,"pageIndex",0),r(this,"pageSize",10),r(this,"totalRecords",0)}async getAllServices(){let t=await l("/Operation/Getallcatering",{reservetype:this.reserveType,currentlng:this.currentLng});t.forEach((t=>{t.quantity1=t.quantity2=0})),this.serviceList=t}caculateSum(){var t;let e=0;null==(t=this.serviceList)||t.forEach((t=>{e+=(t.quantity1+t.quantity2)*t.unitprice})),this.sumApplyPrice=e}async getAppliedList(t,e){let a=await l("Operation/Getcateringlistbyuser",{reservetype:this.reserveType,currentlng:this.currentLng,pageIndex:t,pageSize:e||this.pageSize});this.appliedList=a.results,this.pageIndex=t,this.totalRecords=a.totalRecord}async getAppliedSum(){var t;let e=await l("Operation/Getcateringlisttotalsumbyuser",{pageIndex:0,reservetype:this.reserveType,currentlng:this.currentLng});return this.sumAppliedPrice=(null==(t=e[0])?void 0:t.totalsum)||0,this.sumAppliedPrice}async postResourceApply(t){var r,o;const s=null==(r=this.serviceList)?void 0:r.map((t=>t.itemno)).join("|"),c=null==(o=this.serviceList)?void 0:o.map((t=>`${t.quantity1},${t.quantity2},0`)).join("|");await l("/Operation/AddCatering",((t,r)=>{for(var o in r||(r={}))a.call(r,o)&&i(t,o,r[o]);if(e)for(var o of e(r))n.call(r,o)&&i(t,o,r[o]);return t})({reservetype:this.reserveType,currentlng:this.currentLng,itemno:s,itemqty:c},t))}async getUserMoreInfo(){let t=await s("user/GetCurrentUserMoreInfo");return this.userInfo=t[0],t[0]}}$([c],R.prototype,"getAllServices",1),$([c],R.prototype,"getAppliedList",1),$([c],R.prototype,"getAppliedSum",1),$([c],R.prototype,"postResourceApply",1);const U=new R;var _=I({props:{t:{type:Function,required:!0},cateringStore:{type:Object,required:!0}},setup(t){const{t:e,cateringStore:a}=t,n="planBooth.resource",i=[{title:e(`${n}.itemno`),dataIndex:"itemno",width:150},{title:e(`${n}.itemname`),dataIndex:"itemname",width:150},{title:e(`${n}.description`),dataIndex:"description"},{title:e(`${n}.unitprice`),dataIndex:"unitprice",width:150},{title:e(`${n}.t_qty1`),dataIndex:"itemno",width:100,customRender:({record:t})=>j(d,{value:t.quantity1,"onUpdate:value":e=>t.quantity1=e,min:0,precision:0,size:"small",style:{width:"50px"},onChange:()=>{a.caculateSum()}},null)},{title:e(`${n}.t_qty2`),dataIndex:"itemno",width:100,customRender:({record:t})=>j(d,{value:t.quantity2,"onUpdate:value":e=>t.quantity2=e,min:0,precision:0,size:"small",style:{width:"50px"},onChange:()=>{a.caculateSum()}},null)}];return()=>j(m,{dataSource:a.serviceList,rowKey:"itemno",columns:i,scroll:{y:"60vh"},pagination:!1},null)}});function k(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!C(t)}var z=I({props:{t:{type:Function,required:!0},cateringStore:{type:Object,required:!0}},setup(t){var e,a,n,i,r,o,l,s;const{t:c,cateringStore:p}=t,u="planBooth.catering",d=x(!1),m=x(),I=w({ContactStandno:"",ContactCompany:null!=(a=null==(e=p.userInfo)?void 0:e.company)?a:"",ContactEmail:null!=(i=null==(n=p.userInfo)?void 0:n.email)?i:"",ContactPhone:null!=(o=null==(r=p.userInfo)?void 0:r.mobile)?o:"",ContactPerson:(null==(l=p.userInfo)?void 0:l.firstname)+" "+(null==(s=p.userInfo)?void 0:s.lastname)});let C=S((()=>{let t=!0;return t&&(t=I.ContactStandno.length>0),t&&(t=I.ContactCompany.length>0),t&&(t=I.ContactEmail.length>0),t&&(t=I.ContactPhone.length>0),t&&(t=I.ContactPerson.length>0),t}));const P=()=>{d.value=!1},q=async()=>{await p.getAllServices(),d.value=!0};function O(){p.sumApplyPrice>0&&b.confirm({content:j("div",null,[c("planBooth.catering.submitinfo"),j("br",null,null),c("planBooth.catering.submitinfo2")]),onOk:async()=>{await p.postResourceApply(L(I)),d.value=!1,p.getAppliedList(0),p.getAppliedSum()},onCancel:()=>{}})}return()=>{let t;return j(A,null,[j(g,{ref:m},{default:()=>[j(h,{gutter:20},{default:()=>[j(y,{span:12},{default:()=>[j(g.Item,{label:c(`${u}.contactstandno`)},{default:()=>[j(v,{type:"text",value:I.ContactStandno,"onUpdate:value":t=>I.ContactStandno=t},null)]})]}),j(y,{span:12},{default:()=>[j(g.Item,{label:c(`${u}.contactcompany`)},{default:()=>[j(v,{type:"text",value:I.ContactCompany,"onUpdate:value":t=>I.ContactCompany=t},null)]})]})]}),j(h,{gutter:20},{default:()=>[j(y,{span:12},{default:()=>[j(g.Item,{label:c(`${u}.contactemail`)},{default:()=>[j(v,{type:"text",value:I.ContactEmail,"onUpdate:value":t=>I.ContactEmail=t},null)]})]}),j(y,{span:12},{default:()=>[j(g.Item,{label:c(`${u}.contactphone`)},{default:()=>[j(v,{type:"text",value:I.ContactPhone,"onUpdate:value":t=>I.ContactPhone=t},null)]})]})]}),j(h,{gutter:20},{default:()=>[j(y,{span:12},{default:()=>[j(g.Item,{label:c(`${u}.contactperson`)},{default:()=>[j(v,{type:"text",value:I.ContactPerson,"onUpdate:value":t=>I.ContactPerson=t},null)]})]})]})]}),j("p",{class:"text_center"},[j(f,{type:"primary",disabled:!p.appliedList||p.appliedList.length>0||!C,onClick:q,loading:p.loading},k(t=c(`${u}.serviceApply`))?t:{default:()=>[t]})]),j(b,{visible:d.value,"onUpdate:visible":t=>d.value=t,width:1080,centered:!0,title:c(`${u}.serviceApplylist`)},{default:()=>[d.value&&j(_,{t:c,cateringStore:p},null)],footer:()=>{let t,e;return j(A,null,[j("b",{class:"text_red",style:{marginRight:"3em"}},[c("planBooth.resource.totalsum"),B(": "),p.sumApplyPrice]),j(f,{key:"back",onClick:P},k(t=c("common.cancel"))?t:{default:()=>[t]}),j(f,{key:"submit",type:"primary",onClick:O},k(e=c("common.submit"))?e:{default:()=>[e]})])}})])}}}),E=I({props:{t:{type:Function,required:!0},cateringStore:{type:Object,required:!0}},setup(t){const{t:e,cateringStore:a}=t;let n=S((()=>({current:a.pageIndex,total:a.totalRecords})));const i=[{title:e("planBooth.standno"),width:100,dataIndex:"standno"},{title:e("planBooth.catering.contactperson"),width:100,dataIndex:"contactperson"},{title:e("planBooth.company"),width:100,dataIndex:"company"},{title:e("planBooth.catering.reserveitemno"),width:100,dataIndex:"reserveitemno"},{title:e("planBooth.catering.itemname"),width:100,dataIndex:"itemname"},{title:e("planBooth.catering.description"),width:100,dataIndex:"description"},{title:e("planBooth.catering.unitprice"),width:100,dataIndex:"unitprice"},{title:e("planBooth.catering.reserveqty1"),width:100,dataIndex:"oneday"},{title:e("planBooth.catering.reserveqty2"),width:100,dataIndex:"twoday"},{title:e("planBooth.catering.createtime"),width:100,dataIndex:"createtime"},{title:e("planBooth.catering.status"),width:100,fixed:"right",dataIndex:"status",customRender:function({record:t}){return j("b",null,[e(`planBooth.catering.statustype[${t.status}]`)])}}];return()=>j("div",{class:"pd_tb_20"},[j(m,{size:"small",bordered:!0,rowKey:"reserveid",columns:i,loading:a.loading,scroll:{x:1400,y:500},dataSource:a.appliedList,pagination:{current:n.value.current,total:n.value.total,onChange:t=>{a.getAppliedList(t)}}},{title:()=>j("h3",null,[e("planBooth.serviceApplylistFurniture")]),footer:()=>j("h3",{class:"text_red text_right"},[e("planBooth.resource.totalsum"),B(": "),a.sumAppliedPrice])})])}}),T=I({setup(){const{t:t,locale:e}=p();let a="en-US"===e.value?"en":"cn";const{cateringStore:n}=(i=a,U.currentLng=i,{cateringStore:U});var i;return P((()=>{n.getUserMoreInfo(),n.getAppliedList(0),n.getAppliedSum()})),()=>j(A,null,[j("div",{class:u.formInfoSection},[j("img",{src:"//wapp.itb-china.com/Pages/pc/pages/logistics/cateringRental/catering/catering.jpg?__=1616649706693"},null),j("div",null,[j("h2",{class:"text_red"},[t("planBooth.catering.formtitle")]),j("div",null,[t("planBooth.catering.formcontact1"),B(" "),t("planBooth.catering.formcontact2")]),j("div",null,[t("planBooth.catering.formcontact3")])])]),n.userInfo&&j(z,{t:t,cateringStore:n},null),j(E,{t:t,cateringStore:n},null)])}});export default T;
