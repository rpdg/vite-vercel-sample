var e=Object.defineProperty,t=(t,r,i)=>(((t,r,i)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i})(t,"symbol"!=typeof r?r+"":r,i),i);import{B as r,p as i,l as o}from"./index.91b85185.js";import{T as s,s as n,l as a,t as c}from"./ant-design-vue.caf0e0b9.js";import{u as l}from"./vue-i18n.bbad715b.js";import{s as u}from"./index.module.08f1abaa.js";import{a2 as p,c as d,a0 as v,$ as m,aq as h,k as y,ag as f,I as g}from"./@vue.5723de44.js";import"./vue-router.0532eeed.js";import"./moment.29305b8e.js";import"./@ant-design.503097a2.js";import"./@ctrl.2e36ce53.js";import"./nprogress.3e43c680.js";import"./axios.a57df465.js";import"./@babel.dc475c8c.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.60ec16aa.js";import"./warning.4abaefa0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.c2b61631.js";import"./source-map.3671d69c.js";import"./vue.3a1030aa.js";var b=Object.defineProperty,j=Object.getOwnPropertyDescriptor,S=(e,t,r,i)=>{for(var o,s=i>1?void 0:i?j(t,r):t,n=e.length-1;n>=0;n--)(o=e[n])&&(s=(i?o(t,r,s):o(s))||s);return i&&s&&b(t,r,s),s};class x extends r{constructor(){super(),t(this,"reserveType"),t(this,"currentLng"),t(this,"resourceList"),t(this,"serviceList"),t(this,"sumApplyPrice",0),t(this,"sumServicePrice",0),t(this,"pageIndex",0),t(this,"pageSize",10),t(this,"totalRecords",0)}async fetchServiceList(e,t){let r=await i("Operation/Getservicelistbyuser",{reservetype:this.reserveType,currentlng:this.currentLng,pageIndex:e,pageSize:t||this.pageSize});this.serviceList=r.results,this.pageIndex=e,this.totalRecords=r.totalRecord}async getServiceSum(){var e;let t=await i("Operation/Getservicelisttotalsumbyuser",{pageIndex:0,reservetype:this.reserveType,currentlng:this.currentLng});return this.sumServicePrice=(null==(e=t[0])?void 0:e.totalsum)||0,this.sumServicePrice}async fetchResources(){let e=await i("Operation/getAllresource",{reservetype:this.reserveType,currentlng:this.currentLng});e.forEach((e=>{e.quantity=0})),this.resourceList=e}caculateSum(){var e;let t=0;null==(e=this.resourceList)||e.forEach((e=>{t+=e.quantity*e.unitprice})),this.sumApplyPrice=t}async postResourceApply(){var e,t;const r=null==(e=this.resourceList)?void 0:e.map((e=>e.itemno)).join("|"),o=null==(t=this.resourceList)?void 0:t.map((e=>e.quantity)).join("|");await i("/Operation/AddResource",{reservetype:this.reserveType,currentlng:this.currentLng,itemno:r,itemqty:o})}}S([o],x.prototype,"fetchServiceList",1),S([o],x.prototype,"getServiceSum",1),S([o],x.prototype,"fetchResources",1),S([o],x.prototype,"postResourceApply",1);var B=p({name:"ServiceApplyTable",props:{t:{type:Function,required:!0},serviceStore:{type:Object,required:!0}},setup(e){const{t:t,serviceStore:r}=e;let i=d((()=>({current:r.pageIndex,total:r.totalRecords})));const o=[{title:t("planBooth.standno"),dataIndex:"standno"},{title:t("planBooth.exhibitor"),dataIndex:"exhibitor"},{title:t("planBooth.company"),dataIndex:"company"},{title:t("planBooth.resource.itemno"),dataIndex:"reserveitemno"},{title:t("planBooth.resource.itemname"),dataIndex:"itemname"},{title:t("planBooth.resource.description"),dataIndex:"description"},{title:t("planBooth.resource.qty"),dataIndex:"reserveqty"},{title:t("planBooth.resource.unitprice"),dataIndex:"unitprice"},{title:t("planBooth.createtime"),dataIndex:"createtime"},{title:t("planBooth.status"),dataIndex:"status",fixed:"right",customRender:({record:e})=>v("b",null,[t(`planBooth.statustype[${e.status}]`)])}];return()=>v("div",{class:"pd_tb_20"},[v(s,{size:"small",bordered:!0,rowKey:"reserveid",columns:o,loading:r.loading,scroll:{x:1400,y:500},dataSource:r.serviceList,pagination:{current:i.value.current,total:i.value.total,onChange:e=>{r.fetchServiceList(e)}}},{title:()=>v("h3",null,[t("planBooth.serviceApplylistFurniture")]),footer:()=>v("h3",{class:"text_red text_right"},[t("planBooth.resource.totalsum"),m(": "),r.sumServicePrice])})])}}),R=p({name:"ServiceResourceList",props:{t:{type:Function,required:!0},serviceStore:{type:Object,required:!0}},setup(e){const{t:t,serviceStore:r}=e,i=[{title:t("planBooth.resource.itemno"),dataIndex:"itemno",width:150},{title:t("planBooth.resource.itemname"),dataIndex:"itemname",width:150},{title:t("planBooth.resource.description"),dataIndex:"description"},{title:t("planBooth.resource.unitprice"),dataIndex:"unitprice",width:150},{title:t("planBooth.resource.qty"),dataIndex:"itemno",width:100,customRender:({record:e})=>v(n,{value:e.quantity,"onUpdate:value":t=>e.quantity=t,min:0,precision:0,size:"small",style:{width:"50px"},onChange:()=>{r.caculateSum()}},null)}];return()=>v(s,{dataSource:r.resourceList,rowKey:"itemno",columns:i,scroll:{y:"60vh"},pagination:!1},null)}});function w(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!f(e)}var L=p({setup(){const{t:e,locale:t}=l();let r="en-US"===t.value?"en":"cn";const{serviceStore:i}=function(e,t){const r=new x;return r.reserveType=e,r.currentLng=t,{serviceStore:r}}("furniture",r);h((()=>{i.fetchServiceList(0,10),i.getServiceSum()}));const o=y(!1),s=()=>{c.confirm({centered:!0,title:e("planBooth.serviceRent.formTitle"),content:v("img",{style:"height:65vh;",src:"//wapp.itb-china.com/Pages/pc/pages/logistics/serviceRental/service/fur.jpg"},null),width:"70vh",okText:e("planBooth.serviceRent.download"),onOk:async()=>{window.open("//wapp.itb-china.com/Pages/pc/pages/logistics/serviceRental/service/fur.jpg")}})},n=()=>{o.value=!1},p=async()=>{await i.fetchResources(),o.value=!0},d=()=>{i.sumApplyPrice>0&&c.confirm({content:v("div",null,[e("planBooth.serviceRent.submitinfo"),v("br",null,null),e("planBooth.serviceRent.submitinfo2")]),onOk:async()=>{await i.postResourceApply(),o.value=!1,i.fetchServiceList(0,10),i.getServiceSum()},onCancel:()=>{}})};return()=>{let t;return v(g,null,[v("div",{class:u.formInfoSection},[v("img",{src:"/assets/furniture.d51494e7.jpg"},null),v("div",null,[v("h2",{class:"text_red"},[e("planBooth.serviceRent.formTitle")]),v("div",null,[e("planBooth.serviceRent.info1")]),v("div",null,[e("planBooth.serviceRent.info2")]),v("div",null,[e("planBooth.serviceRent.info3")]),v("div",null,[e("planBooth.serviceRent.info4")]),v("div",null,[e("planBooth.serviceRent.info5",{email:"cai.wl@sunhills.cn"})]),v("div",null,[e("planBooth.serviceRent.info6")])])]),v("div",null,[e("planBooth.serviceRent.furniturepic")," ",v("img",{onClick:s,src:"/assets/funitureicon2.d851f585.png",width:"32",class:"cursor_hand"},null),v("div",{style:"text-align:center;"},[v(a,{type:"primary",onClick:p,disabled:!i.serviceList||i.serviceList.length>0,loading:i.loading},w(t=e("planBooth.serviceRent.serviceApply"))?t:{default:()=>[t]})])]),v(c,{visible:o.value,"onUpdate:visible":e=>o.value=e,width:1080,centered:!0,title:e("planBooth.serviceRent.serviceApplyList")},{default:()=>[o.value&&v(R,{t:e,serviceStore:i},null)],footer:()=>{let t,r;return v(g,null,[v("b",{class:"text_red",style:{marginRight:"3em"}},[e("planBooth.resource.totalsum"),m(": "),i.sumApplyPrice]),v(a,{key:"back",onClick:n},w(t=e("common.cancel"))?t:{default:()=>[t]}),v(a,{key:"submit",type:"primary",onClick:d},w(r=e("common.submit"))?r:{default:()=>[r]})])}}),v(B,{t:e,serviceStore:i},null)])}}});export default L;
