import{u as k,a as B,d as h,L as N,U as $}from"./index.9e11243e.js";import{u as v}from"./vue-i18n.0711e616.js";import{S as D}from"./Config.87ac60ee.js";import{I as H,e as O,B as A,G as x}from"./ant-design-vue.034afe85.js";import{d as g,k as e,F as T,u as y,l as L,o as E,c as Y,i as q,n as G}from"./@vue.fa05379c.js";import{p as j}from"./Image.f0a737d7.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.19d3e859.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./BlankGif.8ca146ab.js";const R="_chatList_lw0gu_1",V="_chatItem_lw0gu_1",F="_avata_lw0gu_12",P="_content_lw0gu_19",z="_time_lw0gu_23",J="_msg_lw0gu_29",W="_chatSection_lw0gu_43",K="_targetUserInfo_lw0gu_46",Q="_info_lw0gu_57",X="_chatMsgBox_lw0gu_61",Z="_invite_lw0gu_69",ee="_invite_title_lw0gu_81",te="_invite_content_lw0gu_84",se="_bubble_lw0gu_96",ae="_left_lw0gu_110",ne="_right_lw0gu_125",re="_sender_lw0gu_141";var n={chatList:R,chatItem:V,avata:F,content:P,time:z,msg:J,chatSection:W,targetUserInfo:K,info:Q,chatMsgBox:X,invite:Z,invite_title:ee,invite_content:te,bubble:se,left:ae,right:ne,sender:re},ie=g({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(r){const{msg:i,selfBarCode:o}=r;return()=>e("div",{key:i.id,class:`${n.bubble} ${i.to_barcode===o?n.left:n.right}`},[e("p",null,[i.msgcontent])])}}),oe=g({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(r){const{t:i}=v(),{msg:o,targetUserName:t}=r;let l=JSON.parse(o.msgcontent);return()=>o.from_barcode===r.selfBarCode?e(T,null,null):e("div",{class:`pd_20 ${n.invite}`,key:o.id},[e("p",{class:n.invite_title},[t,y(" "),i("myItb.chat.invite_you_attend")]),e("div",{class:n.invite_content},[e("img",{src:j(o.from_HeadImageUrl),alt:""},null),e("img",{src:j(o.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${l.beginDate.substr(0,10)}`,e("br",null,null),`${l.beginDate.substr(11,5)} ~ ${l.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function le(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!q(r)}var ce=g({name:"Chat",setup(){var a,I,S,U;const{t:r}=v(),{appStore:i}=B(),{authenStore:o}=k(),{chatStore:t}=h(),l=L(""),_=L(),d=o.user.barcode;E(async()=>{await t.getChattingMessages(t.targetUser.employee_id),p()});function p(){let u=_.value;u.scrollTop=u.scrollHeight}async function b(){l.value&&(await t.sendChattingMessage(l.value),l.value="",G(p))}function f(u){return u.map(c=>{if(c.msgtype<2)return e(ie,{key:c.id,msg:c,selfBarCode:d},null);if(c.msgtype<6)return e(oe,{key:c.id,msg:c,targetUserName:s.name,selfBarCode:d},null);if(c.msgtype===6)return e("div",{key:c.id,class:`pd_20 ${n.invite}`},[y("\u540D\u7247")])})}let s=Y({name:i.isEn?((a=t.targetUser)==null?void 0:a.firstname)+" "+((I=t.targetUser)==null?void 0:I.lastname):""+((S=t.targetUser)==null?void 0:S.lastname_cn)+((U=t.targetUser)==null?void 0:U.firstname_cn)});return()=>{var u,c,M,w,C;return e("section",{class:n.chatSection,key:(u=t.targetUser)==null?void 0:u.employee_id},[e("div",{class:n.targetUserInfo},[e("img",{class:n.avata,src:`${D}${(c=t.targetUser)==null?void 0:c.HeadImageUrl}`},null),e("div",{class:n.info},[e("h4",null,[s.name]),e("div",null,[i.isEn?(M=t.targetUser)==null?void 0:M.company:(w=t.targetUser)==null?void 0:w.company_cn]),e("div",null,[(C=t.targetUser)==null?void 0:C.job_title])])]),e("div",{ref:_,class:n.chatMsgBox},[t.chattingMsgs&&f(t.chattingMsgs)]),e("div",{class:n.sender},[e(H,{type:"text",value:l.value,"onUpdate:value":m=>l.value=m},{suffix:()=>{let m;return e(O,{style:{backgroundColor:"black",color:"white"},onClick:b},le(m=r("myItb.chat.send"))?m:{default:()=>[m]})}})])])}}}),ue=g({name:"MsgList",setup(){var f;const{t:r}=v(),{appStore:i}=B(),{authenStore:o}=k(),{chatStore:t}=h(),l=(f=o.user)==null?void 0:f.barcode;function _(s){return i.isEn?s.firstname+" "+s.lastname:s.lastname_cn+s.firstname_cn}E(()=>{t.chattingMsgs=t.targetUser=void 0,t.lastMessages?t.getLastMessages():t.refreshMsgList()});function d(s){let a={job_title:s.job_title,employee_id:s.barcode,HeadImageUrl:s.HeadImageUrl,firstname_cn:s.firstname_cn,firstname:s.firstname,lastname_cn:s.lastname_cn,lastname:s.lastname,company:s.company,company_cn:s.company_cn,IsOnline:0};t.chatWith(a)}function p(s){let a=s.last_message;if(a.msgtype===0)return e("span",null,[a.msgcontent]);if(a.msgtype===1)return e("span",null,[r("myItb.messages.reply_message")]);if(a.msgtype>1&&a.msgtype<6)return e("span",null,[r("myItb.messages.invite_message")]);if(a.msgtype===6)return e("span",null,[r("myItb.messages.card_message")])}function b(s){return s.length>0?s.map(a=>e("div",{key:a.barcode,class:n.chatItem,onClick:()=>{d(a)}},[e("img",{class:n.avata,src:j(a.HeadImageUrl),onClick:()=>{d(a)}},null),e("div",{class:n.content},[e("span",{class:n.time},[$(a.last_message.createdatetime,o.minutesOffset,"YYYY-MM-DD")]),e(A,{dot:a.last_message.from_barcode!=l&&a.last_message.status===0},{default:()=>[e("h4",null,[_(a),y(" ")])]}),e("div",{class:n.msg},[p(a)])])])):e(x,{image:x.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:n.chatList},[t.lastMessages?b(t.lastMessages):e(N,null,null)])}}),Ae=g({name:"ChatSection",setup(){const{t:r}=v(),{chatStore:i}=h();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{i.chattingMsgs=i.targetUser=void 0,i.viewState=0}},[r("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[i.viewState===0?e(ue,null,null):e(ce,null,null)])])}});export{Ae as default};
