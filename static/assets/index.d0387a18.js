import{a as M,u as I,d as f,L,U as k}from"./index.66308b41.js";import{u as S}from"./vue-i18n.0711e616.js";import{I as E,g as w,B as D,G as C}from"./ant-design-vue.0721aa65.js";import{d as _,k as t,l as U,o as $,u as B,i as O,n as H,I as N}from"./@vue.fa05379c.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";const T="_chatList_7hh1p_1",Y="_chatItem_7hh1p_1",A="_avata_7hh1p_12",R="_content_7hh1p_19",V="_time_7hh1p_23",q="_msg_7hh1p_29",G="_chatSection_7hh1p_43",P="_targetUserInfo_7hh1p_46",z="_info_7hh1p_56",J="_chatMsgBox_7hh1p_60",W="_invite_7hh1p_68",F="_invite_title_7hh1p_80",K="_bubble_7hh1p_83",Q="_left_7hh1p_97",X="_right_7hh1p_112",Z="_sender_7hh1p_128";var e={chatList:T,chatItem:Y,avata:A,content:R,time:V,msg:q,chatSection:G,targetUserInfo:P,info:z,chatMsgBox:J,invite:W,invite_title:F,bubble:K,left:Q,right:X,sender:Z},tt=_({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(o){const{msg:r,selfBarCode:i}=o;return()=>t("div",{key:r.id,class:`${e.bubble} ${r.to_barcode===i?e.left:e.right}`},[t("p",null,[r.msgcontent])])}});function et(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!O(o)}var at=_({name:"Chat",setup(){const{t:o}=S(),{appStore:r}=I(),{authenStore:i}=M(),{chatStore:s}=f(),l=U(""),h=U(),m=i.user.barcode;$(async()=>{await s.getChattingMessages(s.targetUser.employee_id),n()});function n(){let d=h.value;d.scrollTop=d.scrollHeight}async function a(){l.value&&(await s.sendChattingMessage(l.value),l.value="",H(n))}function x(d){return d.map(c=>{if(c.msgtype<2)return t(tt,{key:c.id,msg:c,selfBarCode:m},null);if(c.msgtype<6){let u=JSON.parse(c.msgcontent);return t("div",{class:`pd_20 ${e.invite}`},[t("p",{class:e.invite_title},[u.fromBarCode,B(" invite you")]),t("div",{class:"text_gray"},[t("p",null,[`${u.beginDate.substr(0,10)}`,t("br",null,null),`${u.beginDate.substr(11,5)} ~ ${u.endDate.substr(11,5)}`]),t("p",null,null)])])}else if(c.msgtype===6)return t("div",{class:`pd_20 ${e.invite}`},[B("\u540D\u7247")])})}return()=>{var d,c,u,g,v,b,y,j;return t("section",{class:e.chatSection},[t("div",{class:e.targetUserInfo},[t("img",{class:e.avata,src:(d=s.targetUser)==null?void 0:d.HeadImageUrl},null),t("div",{class:e.info},[t("h4",null,[r.isEn?((c=s.targetUser)==null?void 0:c.firstname)+" "+((u=s.targetUser)==null?void 0:u.lastname):""+((g=s.targetUser)==null?void 0:g.lastname_cn)+((v=s.targetUser)==null?void 0:v.firstname_cn)]),t("div",null,[(b=s.targetUser)==null?void 0:b.job_title]),t("div",null,[r.isEn?(y=s.targetUser)==null?void 0:y.company:(j=s.targetUser)==null?void 0:j.company_cn])])]),t("div",{ref:h,class:e.chatMsgBox},[s.chattingMsgs&&x(s.chattingMsgs)]),t("div",{class:e.sender},[t(E,{type:"text",value:l.value,"onUpdate:value":p=>l.value=p},{suffix:()=>{let p;return t(w,{style:{backgroundColor:"black",color:"white"},onClick:a},et(p=o("myItb.chat.send"))?p:{default:()=>[p]})}})])])}}}),st=_({name:"MsgList",setup(){var m;const{appStore:o}=I(),{authenStore:r}=M(),{chatStore:i}=f(),s=(m=r.user)==null?void 0:m.barcode;N(()=>{i.lastMessages?i.getLastMessages():i.refreshMsgList()});function l(n){let a={job_title:n.job_title,employee_id:n.barcode,HeadImageUrl:n.HeadImageUrl,firstname_cn:n.firstname_cn,firstname:n.firstname,lastname_cn:n.lastname_cn,lastname:n.lastname,company:n.company,company_cn:n.company_cn,IsOnline:0};i.chatWith(a)}function h(n){return n.length>0?n.map(a=>t("div",{key:a.barcode,class:e.chatItem},[t("img",{class:e.avata,src:a.HeadImageUrl,onClick:()=>{l(a)}},null),t("div",{class:e.content},[t("span",{class:e.time},[k(a.last_message.createdatetime,r.minutesOffset,"YYYY-MM-DD")]),t(D,{dot:a.last_message.from_barcode!=s&&a.last_message.status===0},{default:()=>[t("h4",{onClick:()=>{l(a)}},[o.isEn?a.firstname+" "+a.lastname:a.lastname_cn+a.firstname_cn," "])]}),t("div",{class:e.msg},[a.last_message.msgcontent])])])):t(C,{image:C.PRESENTED_IMAGE_SIMPLE},null)}return()=>t("div",{class:e.chatList},[i.lastMessages?h(i.lastMessages):t(L,null,null)])}}),xt=_({name:"ChatSection",setup(){const{t:o}=S(),{chatStore:r}=f();return()=>t("div",{class:"ant-card ant-card-bordered"},[t("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[t("div",{class:"ant-card-head-wrapper"},[t("div",{class:"ant-card-head-title"},[o("myItb.dockIcons.chat")])])]),t("div",{class:"ant-card-body",style:"padding: 2px;"},[r.viewState===0?t(st,null,null):t(at,null,null)])])}});export{xt as default};
