import{c as p,e as y,U as C,b as L,r as D,u as O,S as w,a as H,L as R}from"./index.3c77b06c.js";import{u as h}from"./vue-i18n.df730e9c.js";import{d as N}from"./avator_red.2a3a1020.js";import{e as U,I as V,B as G,J as E}from"./ant-design-vue.84ff5d3b.js";import{b as P}from"./BussinessCardStore.6ce28928.js";import{d as f,k as e,i as A,u as x,l as T,o as Y,f as z,c as F,n as W}from"./@vue.f0a33739.js";import"./@rpdg.e35df5be.js";import"./vue-router.85e08d32.js";import"./moment.29305b8e.js";import"./@ant-design.a109b705.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.7aed06b8.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.647f38fa.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.19fb0a11.js";import"./source-map.e9534891.js";import"./vue.e0a06ef1.js";const K="_chatList_1qx44_1",Q="_chatItem_1qx44_1",X="_avata_1qx44_12",Z="_content_1qx44_19",ee="_time_1qx44_23",te="_msg_1qx44_29",se="_chatSection_1qx44_43",ae="_targetUserInfo_1qx44_46",ne="_info_1qx44_57",re="_chatMsgBox_1qx44_61",ie="_invite_1qx44_69",oe="_refused_1qx44_81",ce="_fromMe_1qx44_85",le="_invite_title_1qx44_88",de="_invite_content_1qx44_91",ue="_imgPhoto_1qx44_103",me="_bubble_1qx44_107",ge="_left_1qx44_121",_e="_right_1qx44_136",pe="_sender_1qx44_152";var s={chatList:K,chatItem:Q,avata:X,content:Z,time:ee,msg:te,chatSection:se,targetUserInfo:ae,info:ne,chatMsgBox:re,invite:ie,refused:oe,fromMe:ce,invite_title:le,invite_content:de,imgPhoto:ue,bubble:me,left:ge,right:_e,sender:pe};function J(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!A(i)}var fe=f({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(i){const{t:o}=h(),{chatStore:c}=y(),{msg:t,targetUserName:n,selfBarCode:m}=i;let l=JSON.parse(t.msgcontent);async function _(){await P.accpetCardExchange(t.from_barcode),await c.updateMessageAccept(t.id,1),c.getChattingMessages(m)}async function b(){await P.denyCardExchange(t.id),await c.updateMessageAccept(t.id,0),c.getChattingMessages(m)}return()=>{if(t.from_barcode===i.selfBarCode)return e("div",{key:`${t.id}-${t.scheduleaccept}`,class:`pd_20 ${s.invite}  ${s.fromMe}`},[e("p",{class:s.invite_title},[o("myItb.chat.request_business_card_from_you",{name:n})]),e("img",{src:p(l.ToCompanyLogo),class:s.imgPhoto},null),e("p",{class:"pd_t_20 text_center"},[o(`myItb.chat.request_business_card_status[${t.scheduleaccept}]`)])]);{let u,a;return e("div",{key:`${t.id}-${t.scheduleaccept}`,class:`pd_20 ${s.invite}`},[e("p",{class:s.invite_title},[o("myItb.chat.request_business_card_to_you",{name:n})]),e("img",{src:p(l.FromCompanyLogo),class:`bg_white pd_20 ${s.imgPhoto}`},null),t.scheduleaccept===-1&&e("p",{class:"pd_t_20 text_right gridCols2",style:{gridGap:"8px"}},[e(U,{onClick:b,block:!0},J(u=o("common.no"))?u:{default:()=>[u]}),e(U,{onClick:_,type:"primary",block:!0},J(a=o("common.yes"))?a:{default:()=>[a]})]),t.scheduleaccept!=-1&&e("p",{class:"pd_t_20 text_center"},[o(`myItb.chat.request_business_card_status[${t.scheduleaccept}]`)])])}}}}),be=f({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(i){const{msg:o,selfBarCode:c}=i;return()=>e("div",{key:o.id,class:`${s.bubble} ${o.to_barcode===c?s.left:s.right}`},[e("p",null,[o.msgcontent])])}}),ve=f({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(i){const{t:o}=h(),{msg:c,targetUserName:t}=i;let n=JSON.parse(c.msgcontent);return n.beginDate=C(n.beginDate,L.minutesOffset),n.endDate=C(n.endDate,L.minutesOffset),()=>c.from_barcode===i.selfBarCode?e("div",{class:`pd_20 ${s.invite} ${s.fromMe}`,key:`${c.id}-${c.scheduleaccept}`,onClick:()=>{D.push(`/calendar/${n.isOnline?"virtual":"physical"}/${n.beginDate.split(" ")[0].replace(/\//g,"-")}`)}},[e("p",{class:s.invite_title},[o("myItb.chat.you_invite_attend"),x(" "),t]),e("div",{class:s.invite_content},[e("img",{src:p(c.from_HeadImageUrl),alt:""},null),e("img",{src:p(c.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${n.beginDate.substr(0,10)}`,e("br",null,null),`${n.beginDate.substr(11,5)} ~ ${n.endDate.substr(11,5)}`]),e("p",null,null)])])]):e("div",{class:`pd_20 ${s.invite}`,key:`${c.id}-${c.scheduleaccept}`,onClick:()=>{D.push(`/calendar/${n.isOnline?"virtual":"physical"}/${n.beginDate.split(" ")[0].replace(/\//g,"-")}`)}},[e("p",{class:s.invite_title},[t,x(" "),o("myItb.chat.invite_you_attend")]),e("div",{class:s.invite_content},[e("img",{src:p(c.from_HeadImageUrl),alt:""},null),e("img",{src:p(c.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${n.beginDate.substr(0,10)}`,e("br",null,null),`${n.beginDate.substr(11,5)} ~ ${n.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function he(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!A(i)}var ye=f({name:"Chat",setup(){var r,M,j,I;const{t:i}=h(),{appStore:o}=H(),{authenStore:c}=O(),{chatStore:t}=y(),n=T(""),m=T(),l=c.user.barcode;Y(async()=>{t.targetUser&&(await t.getChattingMessages(l),t.startLongPullMessages(l),_())}),z(()=>{t.stopLongPullMessages()});function _(){let g=m.value;g.scrollTop=g.scrollHeight}async function b(){n.value&&(await t.sendChattingMessage(n.value),n.value="",W(_))}function u(g){return g.map(d=>{if(d.msgtype<2)return e(be,{key:d.id,msg:d,selfBarCode:l},null);if(d.msgtype<6)return e(ve,{key:d.id,msg:d,targetUserName:a.name,selfBarCode:l},null);if(d.msgtype===6)return e(fe,{key:d.id,msg:d,targetUserName:a.name,selfBarCode:l},null)})}let a=F({name:o.isEn?((r=t.targetUser)==null?void 0:r.firstname)+" "+((M=t.targetUser)==null?void 0:M.lastname):""+((j=t.targetUser)==null?void 0:j.lastname_cn)+((I=t.targetUser)==null?void 0:I.firstname_cn)});return()=>{var g,d,S,$,q,k,B;return e("section",{class:s.chatSection,key:(g=t.targetUser)==null?void 0:g.employee_id},[e("div",{class:s.targetUserInfo},[((d=t.targetUser)==null?void 0:d.HeadImageUrl)!=null&&((S=t.targetUser)==null?void 0:S.HeadImageUrl)!=""?e("img",{class:s.avata,src:`${w}${($=t.targetUser)==null?void 0:$.HeadImageUrl}`},null):e("img",{class:s.avata,src:N},null),e("div",{class:s.info},[e("h4",null,[a.name]),e("div",null,[o.isEn?(q=t.targetUser)==null?void 0:q.company:(k=t.targetUser)==null?void 0:k.company_cn]),e("div",null,[(B=t.targetUser)==null?void 0:B.job_title])])]),e("div",{ref:m,class:s.chatMsgBox},[t.chattingMsgs&&u(t.chattingMsgs)]),e("div",{class:s.sender},[e(V,{type:"text",value:n.value,"onUpdate:value":v=>n.value=v},{suffix:()=>{let v;return e(U,{style:{backgroundColor:"black",color:"white"},onClick:b},he(v=i("myItb.chat.send"))?v:{default:()=>[v]})}})])])}}}),Ce=f({name:"MsgList",setup(){var u;const{t:i}=h(),{appStore:o}=H(),{authenStore:c}=O(),{chatStore:t}=y(),n=(u=c.user)==null?void 0:u.barcode;function m(a){return o.isEn?a.firstname+" "+a.lastname:a.lastname_cn+a.firstname_cn}Y(()=>{t.chattingMsgs=t.targetUser=void 0,t.lastMessages?t.getLastMessages():t.refreshMsgList()});function l(a){let r={job_title:a.job_title,employee_id:a.barcode,HeadImageUrl:a.HeadImageUrl,firstname_cn:a.firstname_cn,firstname:a.firstname,lastname_cn:a.lastname_cn,lastname:a.lastname,logoUrl:a.logoUrl,company:a.company,company_cn:a.company_cn,IsOnline:0};t.chatWith(r)}function _(a){let r=a.last_message;if(r.msgtype===0)return e("span",null,[r.msgcontent]);if(r.msgtype===1)return e("span",null,[i("myItb.messages.reply_message")]);if(r.msgtype>1&&r.msgtype<6)return e("span",null,[i("myItb.messages.invite_message")]);if(r.msgtype===6)return e("span",null,[i("myItb.messages.card_message")])}function b(a){return a.length>0?a.map(r=>e("div",{key:r.barcode,class:s.chatItem,onClick:()=>{l(r)}},[r.HeadImageUrl!=null&&r.HeadImageUrl!=""?e("img",{class:s.avata,src:`${w}${r.HeadImageUrl}`,onClick:()=>{l(r)}},null):e("img",{class:s.avata,src:N,onClick:()=>{l(r)}},null),e("div",{class:s.content},[e("span",{class:s.time},[C(r.last_message.createdatetime,c.minutesOffset,"YYYY-MM-DD")]),e(G,{dot:r.last_message.from_barcode!=n&&r.last_message.status===0},{default:()=>[e("h4",null,[m(r),x(" ")])]}),e("div",{class:s.msg},[_(r)])])])):e(E,{image:E.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:s.chatList},[t.lastMessages?b(t.lastMessages):e(R,null,null)])}}),We=f({name:"ChatSection",setup(){const{t:i}=h(),{chatStore:o}=y();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{o.chattingMsgs=o.targetUser=void 0,o.viewState=0}},[i("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[o.viewState===0?e(Ce,null,null):e(ye,null,null)])])}});export{We as default};
