import{a as C,u as k,d as v,L as N,U as O}from"./index.5a0626d5.js";import{u as b}from"./vue-i18n.8989ea2a.js";import{p}from"./Image.f0a737d7.js";import{I as D,g as H,B as $,G as x}from"./ant-design-vue.6d320070.js";import{d as g,k as t,u as B,l as L,o as E,c as T,i as Y,n as q}from"./@vue.f0f90a02.js";import"./vue-router.65bc85cf.js";import"./moment.29305b8e.js";import"./@ant-design.b29a0759.js";import"./@ctrl.2e36ce53.js";import"./nprogress.8b9ed5b7.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.35d5f340.js";import"./source-map.3671d69c.js";import"./vue.8bc7d658.js";import"./BlankGif.8ca146ab.js";import"./Config.87ac60ee.js";const A="_chatList_lw0gu_1",G="_chatItem_lw0gu_1",R="_avata_lw0gu_12",V="_content_lw0gu_19",J="_time_lw0gu_23",P="_msg_lw0gu_29",z="_chatSection_lw0gu_43",W="_targetUserInfo_lw0gu_46",F="_info_lw0gu_57",K="_chatMsgBox_lw0gu_61",Q="_invite_lw0gu_69",X="_invite_title_lw0gu_81",Z="_invite_content_lw0gu_84",tt="_bubble_lw0gu_96",et="_left_lw0gu_110",at="_right_lw0gu_125",st="_sender_lw0gu_141";var a={chatList:A,chatItem:G,avata:R,content:V,time:J,msg:P,chatSection:z,targetUserInfo:W,info:F,chatMsgBox:K,invite:Q,invite_title:X,invite_content:Z,bubble:tt,left:et,right:at,sender:st},nt=g({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(i){const{msg:r,selfBarCode:n}=i;return()=>t("div",{key:r.id,class:`${a.bubble} ${r.to_barcode===n?a.left:a.right}`},[t("p",null,[r.msgcontent])])}}),rt=g({props:{msg:{type:Object,required:!0},targetUserName:String},setup(i){const{t:r}=b(),{msg:n,targetUserName:s}=i;let l=JSON.parse(n.msgcontent);return()=>t("div",{class:`pd_20 ${a.invite}`,key:n.id},[t("p",{class:a.invite_title},[s,B(" "),r("myItb.chat.invite_you_attend")]),t("div",{class:a.invite_content},[t("img",{src:p(n.from_HeadImageUrl),alt:""},null),t("img",{src:p(n.to_HeadImageUrl),alt:""},null),t("div",{class:"text_gray mg_l_20"},[t("p",{class:"text_12"},[`${l.beginDate.substr(0,10)}`,t("br",null,null),`${l.beginDate.substr(11,5)} ~ ${l.endDate.substr(11,5)}`]),t("p",null,null)])])])}});function ot(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Y(i)}var it=g({name:"Chat",setup(){var y,j,M,U;const{t:i}=b(),{appStore:r}=k(),{authenStore:n}=C(),{chatStore:s}=v(),l=L(""),_=L(),f=n.user.barcode;E(async()=>{await s.getChattingMessages(s.targetUser.employee_id),u()});function u(){let d=_.value;d.scrollTop=d.scrollHeight}async function e(){l.value&&(await s.sendChattingMessage(l.value),l.value="",q(u))}function o(d){return d.map(c=>{if(c.msgtype<2)return t(nt,{key:c.id,msg:c,selfBarCode:f},null);if(c.msgtype<6)return t(rt,{msg:c,targetUserName:h.name,key:c.id},null);if(c.msgtype===6)return t("div",{class:`pd_20 ${a.invite}`},[B("\u540D\u7247")])})}let h=T({name:r.isEn?((y=s.targetUser)==null?void 0:y.firstname)+" "+((j=s.targetUser)==null?void 0:j.lastname):""+((M=s.targetUser)==null?void 0:M.lastname_cn)+((U=s.targetUser)==null?void 0:U.firstname_cn)});return()=>{var d,c,I,S,w;return t("section",{class:a.chatSection,key:(d=s.targetUser)==null?void 0:d.employee_id},[t("div",{class:a.targetUserInfo},[t("img",{class:a.avata,src:p((c=s.targetUser)==null?void 0:c.HeadImageUrl)},null),t("div",{class:a.info},[t("h4",null,[h.name]),t("div",null,[(I=s.targetUser)==null?void 0:I.job_title]),t("div",null,[r.isEn?(S=s.targetUser)==null?void 0:S.company:(w=s.targetUser)==null?void 0:w.company_cn])])]),t("div",{ref:_,class:a.chatMsgBox},[s.chattingMsgs&&o(s.chattingMsgs)]),t("div",{class:a.sender},[t(D,{type:"text",value:l.value,"onUpdate:value":m=>l.value=m},{suffix:()=>{let m;return t(H,{style:{backgroundColor:"black",color:"white"},onClick:e},ot(m=i("myItb.chat.send"))?m:{default:()=>[m]})}})])])}}}),lt=g({name:"MsgList",setup(){var u;const{appStore:i}=k(),{authenStore:r}=C(),{chatStore:n}=v(),s=(u=r.user)==null?void 0:u.barcode;E(()=>{n.chattingMsgs=n.targetUser=void 0,n.lastMessages?n.getLastMessages():n.refreshMsgList()});function l(e){let o={job_title:e.job_title,employee_id:e.barcode,HeadImageUrl:e.HeadImageUrl,firstname_cn:e.firstname_cn,firstname:e.firstname,lastname_cn:e.lastname_cn,lastname:e.lastname,company:e.company,company_cn:e.company_cn,IsOnline:0};n.chatWith(o)}function _(e){if(e.msgtype===0)return t("span",null,[e.msgcontent]);if(e.msgcontent.indexOf('{"')===0)return t("span",null,[JSON.parse(e.msgcontent).fromBarCode])}function f(e){return e.length>0?e.map(o=>t("div",{key:o.barcode,class:a.chatItem,onClick:()=>{l(o)}},[t("img",{class:a.avata,src:p(o.HeadImageUrl),onClick:()=>{l(o)}},null),t("div",{class:a.content},[t("span",{class:a.time},[O(o.last_message.createdatetime,r.minutesOffset,"YYYY-MM-DD")]),t($,{dot:o.last_message.from_barcode!=s&&o.last_message.status===0},{default:()=>[t("h4",null,[i.isEn?o.firstname+" "+o.lastname:o.lastname_cn+o.firstname_cn," "])]}),t("div",{class:a.msg},[_(o.last_message)])])])):t(x,{image:x.PRESENTED_IMAGE_SIMPLE},null)}return()=>t("div",{class:a.chatList},[n.lastMessages?f(n.lastMessages):t(N,null,null)])}}),Ht=g({name:"ChatSection",setup(){const{t:i}=b(),{chatStore:r}=v();return()=>t("div",{class:"ant-card ant-card-bordered"},[t("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[t("div",{class:"ant-card-head-wrapper"},[t("div",{class:"ant-card-head-title",onClick:()=>{r.chattingMsgs=r.targetUser=void 0,r.viewState=0}},[i("myItb.dockIcons.chat")])])]),t("div",{class:"ant-card-body",style:"padding: 2px;"},[r.viewState===0?t(lt,null,null):t(it,null,null)])])}});export{Ht as default};
