import{s as g,L as q,a as B}from"./index.436e18a9.js";import{u as j}from"./vue-i18n.0711e616.js";import{a as P,u as x,d as S}from"./vue-router.8ec3c3d8.js";import{u as T,a as L}from"./index.d2d4ce4a.js";import{F as l,I as v,s as _,e as w,p as E}from"./ant-design-vue.034afe85.js";import{x as M,J as R,M as $,K as A}from"./@ant-design.8f5596ac.js";import{d as C,l as k,c as b,k as e,i as I,B as G,I as H}from"./@vue.fa05379c.js";import{B as N}from"./BlankGif.8ca146ab.js";import"./HomeStore.0fd3dec2.js";import"./@intlify.0eca950e.js";import"./nprogress.35503c85.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./moment.29305b8e.js";import"./axios.19d3e859.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@ctrl.2e36ce53.js";function O(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!I(t)}var z=C({name:"Login_PasswordForm",setup(){const{authenStore:t}=T(),{appStore:c}=L(),p=P(),d=x(),{t:r}=j({useScope:"global"}),f=k(),o=b({username:"",password:"",agreed:!0}),h=b({username:[{required:!0,message:r("login.usernameTip"),trigger:"change"}],password:[{required:!0,message:r("login.passwordTip"),trigger:"change"}]});async function y(){var a,m;try{await f.value.validate(),await t.loginWithPassword(G(o)),d.push((m=(a=p.query)==null?void 0:a.redirect)!=null?m:"/home")}catch(u){console.log("error",u)}}return()=>{let a,m;return e(l,{ref:f,model:o,rules:h},{default:()=>[e(l.Item,{name:"username"},{default:()=>[e(v,{value:o.username,"onUpdate:value":u=>o.username=u,placeholder:r("login.username")},{prefix:()=>e(M,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(l.Item,{name:"password"},{default:()=>[e(v,{type:"password",value:o.password,"onUpdate:value":u=>o.password=u,placeholder:r("login.password")},{prefix:()=>e(R,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(l.Item,{name:"agreed"},{default:()=>[e(_,{checked:o.agreed,"onUpdate:checked":u=>o.agreed=u},{default:()=>[e(S,{to:c.isEn?"/agreementEn":"/agreement"},O(a=r("login.agreeTip"))?a:{default:()=>[a]})]})]}),e(l.Item,null,{default:()=>[e(w,{type:"primary",block:!0,disabled:!o.agreed,loading:t.loading,onClick:y},O(m=r("login.login"))?m:{default:()=>[m]})]})]})}}});function J(t){return/^1[3456789]\d{9}$/.test(t)}function U(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!I(t)}var K=C({name:"Login_PasswordForm",setup(){const{authenStore:t}=T(),{appStore:c}=L(),p=P(),d=x(),{t:r}=j({useScope:"global"});H(()=>{t.getImgCode()});const f=k(),o=b({action:"sms",mobile:"",graphVerifyCode:"",verifyCode:"",agreed:!0,sendingSms:!1}),h=r("myItb.chat.send"),y="59",a=k(h);let m=async(i,n)=>J(n)?Promise.resolve():Promise.reject(r("login.mobileTip2")),u=async(i,n)=>o.action==="login"&&n===""?Promise.reject(r("login.smsCodeTip")):Promise.resolve();const V=b({mobile:[{required:!0,message:r("login.mobileTip"),trigger:"change"},{validator:m,trigger:"change"}],graphVerifyCode:[{required:!0,message:r("login.graphicCodeTip"),trigger:"change"}],verifyCode:[{validator:u,trigger:"change"}]});async function F(){o.action="sms";try{await f.value.validate(),o.sendingSms=!0,a.value=y;let i=setInterval(function(){~~a.value-1<1?(clearInterval(i),o.sendingSms=!1,a.value=h):a.value=~~a.value-1},1e3);await t.sendSmsCode(o.mobile,o.graphVerifyCode)&&E.success({message:r("login.smsSendSuccess")})}catch(i){console.log("error",i)}}async function W(){var i,n;o.action="login";try{await f.value.validate(),await t.loginWithSms(o.mobile,o.verifyCode),d.push((n=(i=p.query)==null?void 0:i.redirect)!=null?n:"/home")}catch(s){console.log("error",s)}}return()=>{let i,n;return e(l,{ref:f,model:o,rules:V},{default:()=>[e(l.Item,{name:"mobile",validateFirst:!0},{default:()=>[e(v,{value:o.mobile,"onUpdate:value":s=>o.mobile=s,placeholder:r("login.mobile")},{prefix:()=>e($,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(l.Item,{name:"graphVerifyCode"},{default:()=>[e(v,{value:o.graphVerifyCode,"onUpdate:value":s=>o.graphVerifyCode=s,placeholder:r("login.graphicCode")},{prefix:()=>e(A,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>{var s;return e("img",{src:((s=t.graphicRes)==null?void 0:s.graphVerifyCodeImg)||N},null)}})]}),e(l.Item,{name:"verifyCode"},{default:()=>[e(v,{value:o.verifyCode,"onUpdate:value":s=>o.verifyCode=s,placeholder:r("login.smsCode")},{prefix:()=>e(R,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>e(w,{style:{backgroundColor:"black",color:"white"},onClick:F,disabled:o.sendingSms},{default:()=>[a.value]})})]}),e(l.Item,{name:"agreed"},{default:()=>[e(_,{checked:o.agreed,"onUpdate:checked":s=>o.agreed=s},{default:()=>[e(S,{to:c.isEn?"/agreementEn":"/agreement"},U(i=r("login.agreeTip"))?i:{default:()=>[i]})]})]}),e(l.Item,null,{default:()=>[e(w,{type:"primary",block:!0,disabled:!o.agreed,loading:t.loading,onClick:W},U(n=r("login.login"))?n:{default:()=>[n]})]})]})}}});function D(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!I(t)}var Ce=C({name:"Login",setup(){const{t}=j({useScope:"global"}),c=b({loginWithPassword:!0});function p(d){c.loginWithPassword=d}return()=>{let d;return e(B,null,{default:()=>[e("div",{class:g.outer},[e("div",{class:g.padding},[e(q,null,null)]),e("div",{class:g.form},[e("h1",null,[t("login.loginForm")]),e("div",{class:g.tabs},[e("div",{class:c.loginWithPassword?g.curTab:"",onClick:()=>{p(!0)}},[e("span",null,[t("login.passwordLogin")])]),e("div",{class:c.loginWithPassword?"":g.curTab,onClick:()=>{p(!1)}},[e("span",null,[t("login.smsLogin")])])]),c.loginWithPassword?e(z,null,null):e(K,null,null)]),e("div",{class:g.padding},[e("p",{class:g.registTip},[e(S,{to:"/signUp"},D(d=t("login.registTip"))?d:{default:()=>[d]})])])])]})}}});export{Ce as default};
