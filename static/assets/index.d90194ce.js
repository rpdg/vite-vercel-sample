import{s as e,L as a,a as o}from"./index.8a9de4ae.js";import{u as r}from"./vue-i18n.bbad715b.js";import{a as l,u as i,d as s}from"./vue-router.0532eeed.js";import{c as t}from"./index.247a591d.js";import{F as n,I as d,k as u,l as c,h as g}from"./ant-design-vue.caf0e0b9.js";import{s as m,y as p,M as f,z as v}from"./@ant-design.503097a2.js";import{a2 as b,k as h,r as y,a0 as j,ag as w,t as C,al as S}from"./@vue.5723de44.js";import{B as k}from"./BlankGif.8ca146ab.js";import"./HomeStore.010bda50.js";import"./@intlify.c2b61631.js";import"./nprogress.3e43c680.js";import"./source-map.3671d69c.js";import"./vue.3a1030aa.js";import"./moment.29305b8e.js";import"./axios.a57df465.js";import"./@babel.dc475c8c.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.60ec16aa.js";import"./warning.4abaefa0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@ctrl.2e36ce53.js";function I(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!w(e)}var P=b({name:"Login_PasswordForm",setup(){const{authenStore:e}=t(),a=l(),o=i(),{t:g}=r({useScope:"global"}),f=h(),v=y({username:"",password:"",agreed:!0}),b=y({username:[{required:!0,message:g("login.usernameTip"),trigger:"change"}],password:[{required:!0,message:g("login.passwordTip"),trigger:"change"}]});async function w(){var r,l;try{await f.value.validate(),await e.loginWithPassword(C(v)),o.push(null!=(l=null==(r=a.query)?void 0:r.redirect)?l:"/home")}catch(i){console.log("error",i)}}return()=>{let a,o;return j(n,{ref:f,model:v,rules:b},{default:()=>[j(n.Item,{name:"username"},{default:()=>[j(d,{value:v.username,"onUpdate:value":e=>v.username=e,placeholder:g("login.username")},{prefix:()=>j(m,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),j(n.Item,{name:"password"},{default:()=>[j(d,{type:"password",value:v.password,"onUpdate:value":e=>v.password=e,placeholder:g("login.password")},{prefix:()=>j(p,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),j(n.Item,{name:"agreed"},{default:()=>[j(u,{checked:v.agreed,"onUpdate:checked":e=>v.agreed=e},{default:()=>[j(s,{to:"/agreement"},I(a=g("login.agreeTip"))?a:{default:()=>[a]})]})]}),j(n.Item,null,{default:()=>[j(c,{type:"primary",block:!0,disabled:!v.agreed,loading:e.loading,onClick:w},I(o=g("login.login"))?o:{default:()=>[o]})]})]})}}});function T(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!w(e)}var x=b({name:"Login_PasswordForm",setup(){const{authenStore:e}=t(),a=l(),o=i(),{t:m}=r({useScope:"global"});S((()=>{e.getImgCode()}));const b=h(),w=y({action:"sms",mobile:"",graphVerifyCode:"",verifyCode:"",agreed:!0,sendingSms:!1}),C=m("myItb.chat.send"),I=h(C);const P=y({mobile:[{required:!0,message:m("login.mobileTip"),trigger:"change"},{validator:async(e,a)=>/^1[3456789]\d{9}$/.test(a)?Promise.resolve():Promise.reject(m("login.mobileTip2")),trigger:"change"}],graphVerifyCode:[{required:!0,message:m("login.graphicCodeTip"),trigger:"change"}],verifyCode:[{validator:async(e,a)=>"login"===w.action&&""===a?Promise.reject(m("login.smsCodeTip")):Promise.resolve(),trigger:"change"}]});async function x(){w.action="sms";try{await b.value.validate(),w.sendingSms=!0,I.value="59";let a=setInterval((function(){~~I.value-1<1?(clearInterval(a),w.sendingSms=!1,I.value=C):I.value=~~I.value-1}),1e3);await e.sendSmsCode(w.mobile,w.graphVerifyCode)&&g.success({message:m("login.smsSendSuccess")})}catch(a){console.log("error",a)}}async function U(){var r,l;w.action="login";try{await b.value.validate(),await e.loginWithSms(w.mobile,w.verifyCode),o.push(null!=(l=null==(r=a.query)?void 0:r.redirect)?l:"/home")}catch(i){console.log("error",i)}}return()=>{let a,o;return j(n,{ref:b,model:w,rules:P},{default:()=>[j(n.Item,{name:"mobile",validateFirst:!0},{default:()=>[j(d,{value:w.mobile,"onUpdate:value":e=>w.mobile=e,placeholder:m("login.mobile")},{prefix:()=>j(f,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),j(n.Item,{name:"graphVerifyCode"},{default:()=>[j(d,{value:w.graphVerifyCode,"onUpdate:value":e=>w.graphVerifyCode=e,placeholder:m("login.graphicCode")},{prefix:()=>j(v,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>{var a;return j("img",{src:(null==(a=e.graphicRes)?void 0:a.graphVerifyCodeImg)||k},null)}})]}),j(n.Item,{name:"verifyCode"},{default:()=>[j(d,{value:w.verifyCode,"onUpdate:value":e=>w.verifyCode=e,placeholder:m("login.smsCode")},{prefix:()=>j(p,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>j(c,{style:{backgroundColor:"black",color:"white"},onClick:x,disabled:w.sendingSms},{default:()=>[I.value]})})]}),j(n.Item,{name:"agreed"},{default:()=>[j(u,{checked:w.agreed,"onUpdate:checked":e=>w.agreed=e},{default:()=>[j(s,{to:"/agreement"},T(a=m("login.agreeTip"))?a:{default:()=>[a]})]})]}),j(n.Item,null,{default:()=>[j(c,{type:"primary",block:!0,disabled:!w.agreed,loading:e.loading,onClick:U},T(o=m("login.login"))?o:{default:()=>[o]})]})]})}}});var U=b({name:"Login",setup(){const{t:l}=r({useScope:"global"}),i=y({loginWithPassword:!0});function t(e){i.loginWithPassword=e}return()=>{let r;return j(o,null,{default:()=>{return[j("div",{class:e.outer},[j("div",{class:e.padding},[j(a,null,null)]),j("div",{class:e.form},[j("h1",null,[l("login.loginForm")]),j("div",{class:e.tabs},[j("div",{class:i.loginWithPassword?e.curTab:"",onClick:()=>{t(!0)}},[j("span",null,[l("login.passwordLogin")])]),j("div",{class:i.loginWithPassword?"":e.curTab,onClick:()=>{t(!1)}},[j("span",null,[l("login.smsLogin")])])]),i.loginWithPassword?j(P,null,null):j(x,null,null)]),j("div",{class:e.padding},[j("p",{class:e.registTip},[j(s,{to:"/signUp"},(o=r=l("login.registTip"),"function"==typeof o||"[object Object]"===Object.prototype.toString.call(o)&&!w(o)?r:{default:()=>[r]}))])])])];var o}})}}});export default U;
