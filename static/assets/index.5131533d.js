import{s as m,L as F,a as W}from"./index.f6eabb61.js";import{u as y}from"./vue-i18n.0711e616.js";import{a as I,u as P,d as j}from"./vue-router.8ec3c3d8.js";import{a as x}from"./index.2911e131.js";import{F as n,I as f,p as T,i as S,n as q}from"./ant-design-vue.b491a4ce.js";import{x as B,J as L,M,K as $}from"./@ant-design.8f5596ac.js";import{d as w,l as C,c as b,k as e,i as k,B as G,I as H}from"./@vue.fa05379c.js";import{B as N}from"./BlankGif.8ca146ab.js";import"./HomeStore.237cb99e.js";import"./@intlify.0eca950e.js";import"./nprogress.35503c85.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./moment.29305b8e.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@ctrl.2e36ce53.js";function _(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!k(t)}var z=w({name:"Login_PasswordForm",setup(){const{authenStore:t}=x(),u=I(),g=P(),{t:r}=y({useScope:"global"}),p=C(),o=b({username:"",password:"",agreed:!0}),v=b({username:[{required:!0,message:r("login.usernameTip"),trigger:"change"}],password:[{required:!0,message:r("login.passwordTip"),trigger:"change"}]});async function h(){var a,c;try{await p.value.validate(),await t.loginWithPassword(G(o)),g.push((c=(a=u.query)==null?void 0:a.redirect)!=null?c:"/home")}catch(d){console.log("error",d)}}return()=>{let a,c;return e(n,{ref:p,model:o,rules:v},{default:()=>[e(n.Item,{name:"username"},{default:()=>[e(f,{value:o.username,"onUpdate:value":d=>o.username=d,placeholder:r("login.username")},{prefix:()=>e(B,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(n.Item,{name:"password"},{default:()=>[e(f,{type:"password",value:o.password,"onUpdate:value":d=>o.password=d,placeholder:r("login.password")},{prefix:()=>e(L,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(n.Item,{name:"agreed"},{default:()=>[e(T,{checked:o.agreed,"onUpdate:checked":d=>o.agreed=d},{default:()=>[e(j,{to:"/agreement"},_(a=r("login.agreeTip"))?a:{default:()=>[a]})]})]}),e(n.Item,null,{default:()=>[e(S,{type:"primary",block:!0,disabled:!o.agreed,loading:t.loading,onClick:h},_(c=r("login.login"))?c:{default:()=>[c]})]})]})}}});function A(t){return/^1[3456789]\d{9}$/.test(t)}function R(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!k(t)}var J=w({name:"Login_PasswordForm",setup(){const{authenStore:t}=x(),u=I(),g=P(),{t:r}=y({useScope:"global"});H(()=>{t.getImgCode()});const p=C(),o=b({action:"sms",mobile:"",graphVerifyCode:"",verifyCode:"",agreed:!0,sendingSms:!1}),v=r("myItb.chat.send"),h="59",a=C(v);let c=async(i,l)=>A(l)?Promise.resolve():Promise.reject(r("login.mobileTip2")),d=async(i,l)=>o.action==="login"&&l===""?Promise.reject(r("login.smsCodeTip")):Promise.resolve();const O=b({mobile:[{required:!0,message:r("login.mobileTip"),trigger:"change"},{validator:c,trigger:"change"}],graphVerifyCode:[{required:!0,message:r("login.graphicCodeTip"),trigger:"change"}],verifyCode:[{validator:d,trigger:"change"}]});async function U(){o.action="sms";try{await p.value.validate(),o.sendingSms=!0,a.value=h;let i=setInterval(function(){~~a.value-1<1?(clearInterval(i),o.sendingSms=!1,a.value=v):a.value=~~a.value-1},1e3);await t.sendSmsCode(o.mobile,o.graphVerifyCode)&&q.success({message:r("login.smsSendSuccess")})}catch(i){console.log("error",i)}}async function V(){var i,l;o.action="login";try{await p.value.validate(),await t.loginWithSms(o.mobile,o.verifyCode),g.push((l=(i=u.query)==null?void 0:i.redirect)!=null?l:"/home")}catch(s){console.log("error",s)}}return()=>{let i,l;return e(n,{ref:p,model:o,rules:O},{default:()=>[e(n.Item,{name:"mobile",validateFirst:!0},{default:()=>[e(f,{value:o.mobile,"onUpdate:value":s=>o.mobile=s,placeholder:r("login.mobile")},{prefix:()=>e(M,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),e(n.Item,{name:"graphVerifyCode"},{default:()=>[e(f,{value:o.graphVerifyCode,"onUpdate:value":s=>o.graphVerifyCode=s,placeholder:r("login.graphicCode")},{prefix:()=>e($,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>{var s;return e("img",{src:((s=t.graphicRes)==null?void 0:s.graphVerifyCodeImg)||N},null)}})]}),e(n.Item,{name:"verifyCode"},{default:()=>[e(f,{value:o.verifyCode,"onUpdate:value":s=>o.verifyCode=s,placeholder:r("login.smsCode")},{prefix:()=>e(L,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>e(S,{style:{backgroundColor:"black",color:"white"},onClick:U,disabled:o.sendingSms},{default:()=>[a.value]})})]}),e(n.Item,{name:"agreed"},{default:()=>[e(T,{checked:o.agreed,"onUpdate:checked":s=>o.agreed=s},{default:()=>[e(j,{to:"/agreement"},R(i=r("login.agreeTip"))?i:{default:()=>[i]})]})]}),e(n.Item,null,{default:()=>[e(S,{type:"primary",block:!0,disabled:!o.agreed,loading:t.loading,onClick:V},R(l=r("login.login"))?l:{default:()=>[l]})]})]})}}});function K(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!k(t)}var Se=w({name:"Login",setup(){const{t}=y({useScope:"global"}),u=b({loginWithPassword:!0});function g(r){u.loginWithPassword=r}return()=>{let r;return e(W,null,{default:()=>[e("div",{class:m.outer},[e("div",{class:m.padding},[e(F,null,null)]),e("div",{class:m.form},[e("h1",null,[t("login.loginForm")]),e("div",{class:m.tabs},[e("div",{class:u.loginWithPassword?m.curTab:"",onClick:()=>{g(!0)}},[e("span",null,[t("login.passwordLogin")])]),e("div",{class:u.loginWithPassword?"":m.curTab,onClick:()=>{g(!1)}},[e("span",null,[t("login.smsLogin")])])]),u.loginWithPassword?e(z,null,null):e(J,null,null)]),e("div",{class:m.padding},[e("p",{class:m.registTip},[e(j,{to:"/signUp"},K(r=t("login.registTip"))?r:{default:()=>[r]})])])])]})}}});export{Se as default};
