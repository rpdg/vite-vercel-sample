import{c as p,e as y,U,b as D,r as O,u as w,S as L,a as H,L as R}from"./index.4fa8ec46.js";import{u as h}from"./vue-i18n.f56f8be1.js";import{d as N}from"./avator_red.2a3a1020.js";import{J as E,e as j,I as V,B as F,K as P}from"./ant-design-vue.f71b2c4d.js";import{b as q}from"./BussinessCardStore.229ec23c.js";import{d as f,k as e,i as A,u as C,l as T,o as Y,f as G,c as K,n as W}from"./@vue.b2913f50.js";import"./@rpdg.8b8261fd.js";import"./vue-router.82b024de.js";import"./moment.29305b8e.js";import"./@ant-design.148651e0.js";import"./@ctrl.2e36ce53.js";import"./nprogress.9dcdc490.js";import"./axios.7aed06b8.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.647f38fa.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.e28dde39.js";import"./source-map.e9534891.js";import"./vue.7093eef6.js";const Q="_chatList_ra7z8_1",X="_chatItem_ra7z8_1",Z="_avata_ra7z8_12",ee="_content_ra7z8_19",te="_time_ra7z8_23",ae="_msg_ra7z8_29",se="_chatSection_ra7z8_43",ne="_targetUserInfo_ra7z8_46",re="_info_ra7z8_57",ie="_chatMsgBox_ra7z8_62",ce="_invite_ra7z8_70",oe="_refused_ra7z8_82",le="_fromMe_ra7z8_86",de="_invite_title_ra7z8_89",ue="_invite_content_ra7z8_92",me="_imgPhoto_ra7z8_104",_e="_bubble_ra7z8_108",ge="_left_ra7z8_122",pe="_right_ra7z8_137",fe="_sender_ra7z8_153";var a={chatList:Q,chatItem:X,avata:Z,content:ee,time:te,msg:ae,chatSection:se,targetUserInfo:ne,info:re,chatMsgBox:ie,invite:ce,refused:oe,fromMe:le,invite_title:de,invite_content:ue,imgPhoto:me,bubble:_e,left:ge,right:pe,sender:fe};function J(c){return typeof c=="function"||Object.prototype.toString.call(c)==="[object Object]"&&!A(c)}var be=f({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(c){const{t:r}=h(),{chatStore:o}=y(),{msg:t,targetUserName:n,selfBarCode:m}=c;let l=JSON.parse(t.msgcontent);async function g(){await q.accpetCardExchange(t.from_barcode),await o.updateMessageAccept(t.id,1),o.getChattingMessages(m),location.reload()}async function b(){await q.denyCardExchange(t.id),await o.updateMessageAccept(t.id,0),o.getChattingMessages(m),location.reload()}return()=>{if(t.from_barcode===c.selfBarCode)return e("div",{key:`${t.id}-${t.scheduleaccept}`,class:`pd_20 ${a.invite}  ${a.fromMe}`},[e("p",{class:a.invite_title},[r("myItb.chat.request_business_card_from_you",{name:n})]),e(E,{src:p(`Data/BusinessCard/${l.FromBarcode}.jpg`),class:a.imgPhoto},null),e("p",{class:"pd_t_20 text_center"},[r(`myItb.chat.request_business_card_status[${t.scheduleaccept}]`)])]);{let u,s;return e("div",{key:`${t.id}-${t.scheduleaccept}`,class:`pd_20 ${a.invite}`},[e("p",{class:a.invite_title},[r("myItb.chat.request_business_card_to_you",{name:n})]),e(E,{src:p(`Data/BusinessCard/${l.FromBarcode}.jpg`),class:`bg_white pd_20 ${a.imgPhoto}`},null),t.scheduleaccept===-1&&e("p",{class:"pd_t_20 text_right gridCols2",style:{gridGap:"8px"}},[e(j,{onClick:b,block:!0},J(u=r("common.no"))?u:{default:()=>[u]}),e(j,{onClick:g,type:"primary",block:!0},J(s=r("common.yes"))?s:{default:()=>[s]})]),t.scheduleaccept!=-1&&e("p",{class:"pd_t_20 text_center"},[r(`myItb.chat.request_business_card_status[${t.scheduleaccept}]`)])])}}}}),ve=f({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(c){const{msg:r,selfBarCode:o}=c;return()=>e("div",{key:r.id,class:`${a.bubble} ${r.to_barcode===o?a.left:a.right}`},[e("p",null,[r.msgcontent])])}}),he=f({props:{msg:{type:Object,required:!0},targetUserName:String,selfBarCode:String},setup(c){const{t:r}=h(),{msg:o,targetUserName:t}=c;let n=JSON.parse(o.msgcontent);return n.beginDate=U(n.beginDate,D.minutesOffset),n.endDate=U(n.endDate,D.minutesOffset),()=>o.from_barcode===c.selfBarCode?e("div",{class:`pd_20 ${a.invite} ${a.fromMe}`,key:`${o.id}-${o.scheduleaccept}`,onClick:()=>{O.push(`/calendar/${n.isOnline?"virtual":"physical"}/${n.beginDate.split(" ")[0].replace(/\//g,"-")}`)}},[e("p",{class:a.invite_title},[r("myItb.chat.you_invite_attend"),C(" "),t,C(" "),r("myItb.chat.you_invite_attend2")]),e("div",{class:a.invite_content},[e("img",{src:p(o.from_HeadImageUrl),alt:""},null),e("img",{src:p(o.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${n.beginDate.substr(0,10)}`,e("br",null,null),`${n.beginDate.substr(11,5)} ~ ${n.endDate.substr(11,5)}`]),e("p",null,null)])])]):e("div",{class:`pd_20 ${a.invite}`,key:`${o.id}-${o.scheduleaccept}`,onClick:()=>{O.push(`/calendar/${n.isOnline?"virtual":"physical"}/${n.beginDate.split(" ")[0].replace(/\//g,"-")}`)}},[e("p",{class:a.invite_title},[t,C(" "),r("myItb.chat.invite_you_attend")]),e("div",{class:a.invite_content},[e("img",{src:p(o.from_HeadImageUrl),alt:""},null),e("img",{src:p(o.to_HeadImageUrl),alt:""},null),e("div",{class:"text_gray mg_l_20"},[e("p",{class:"text_12"},[`${n.beginDate.substr(0,10)}`,e("br",null,null),`${n.beginDate.substr(11,5)} ~ ${n.endDate.substr(11,5)}`]),e("p",null,null)])])])}});function ye(c){return typeof c=="function"||Object.prototype.toString.call(c)==="[object Object]"&&!A(c)}var Ce=f({name:"Chat",setup(){var i,I,M,S;const{t:c}=h(),{appStore:r}=H(),{authenStore:o}=w(),{chatStore:t}=y(),n=T(""),m=T(),l=o.user.barcode;Y(async()=>{t.targetUser&&(await t.getChattingMessages(l),t.startLongPullMessages(l),g())}),G(()=>{t.stopLongPullMessages()});function g(){let _=m.value;_.scrollTop=_.scrollHeight}async function b(){n.value&&(await t.sendChattingMessage(n.value),n.value="",W(g))}function u(_){return _.map(d=>{if(d.msgtype<2)return e(ve,{key:d.id,msg:d,selfBarCode:l},null);if(d.msgtype<6)return e(he,{key:d.id,msg:d,targetUserName:s.name,selfBarCode:l},null);if(d.msgtype===6)return e(be,{key:d.id,msg:d,targetUserName:s.name,selfBarCode:l},null)})}let s=K({name:r.isEn?((i=t.targetUser)==null?void 0:i.firstname)+" "+((I=t.targetUser)==null?void 0:I.lastname):""+((M=t.targetUser)==null?void 0:M.lastname_cn)+((S=t.targetUser)==null?void 0:S.firstname_cn)});return()=>{var _,d,$,k,B,x,z;return e("section",{class:a.chatSection,key:(_=t.targetUser)==null?void 0:_.employee_id},[e("div",{class:a.targetUserInfo},[((d=t.targetUser)==null?void 0:d.HeadImageUrl)!=null&&(($=t.targetUser)==null?void 0:$.HeadImageUrl)!=""?e("img",{class:a.avata,src:`${L}${(k=t.targetUser)==null?void 0:k.HeadImageUrl}`},null):e("img",{class:a.avata,src:N},null),e("div",{class:a.info},[e("h4",null,[s.name]),e("div",null,[r.isEn?(B=t.targetUser)==null?void 0:B.company:(x=t.targetUser)==null?void 0:x.company_cn]),e("div",null,[(z=t.targetUser)==null?void 0:z.job_title])])]),e("div",{ref:m,class:a.chatMsgBox},[t.chattingMsgs&&u(t.chattingMsgs)]),e("div",{class:a.sender},[e(V,{type:"text",value:n.value,"onUpdate:value":v=>n.value=v},{suffix:()=>{let v;return e(j,{style:{backgroundColor:"black",color:"white"},onClick:b},ye(v=c("myItb.chat.send"))?v:{default:()=>[v]})}})])])}}}),Ue=f({name:"MsgList",setup(){var u;const{t:c}=h(),{appStore:r}=H(),{authenStore:o}=w(),{chatStore:t}=y(),n=(u=o.user)==null?void 0:u.barcode;function m(s){return r.isEn?s.firstname+" "+s.lastname:s.lastname_cn+s.firstname_cn}Y(()=>{t.chattingMsgs=t.targetUser=void 0,t.lastMessages?t.getLastMessages():t.refreshMsgList()});function l(s){let i={job_title:s.job_title,employee_id:s.barcode,HeadImageUrl:s.HeadImageUrl,firstname_cn:s.firstname_cn,firstname:s.firstname,lastname_cn:s.lastname_cn,lastname:s.lastname,logoUrl:s.logoUrl,company:s.company,company_cn:s.company_cn,IsOnline:0};t.chatWith(i)}function g(s){let i=s.last_message;if(i.msgtype===0)return e("span",null,[i.msgcontent]);if(i.msgtype===1)return e("span",null,[c("myItb.messages.reply_message")]);if(i.msgtype>1&&i.msgtype<6)return e("span",null,[c("myItb.messages.invite_message")]);if(i.msgtype===6)return e("span",null,[c("myItb.messages.card_message")])}function b(s){return s.length>0?s.map(i=>e("div",{key:i.barcode,class:a.chatItem,onClick:()=>{l(i)}},[i.HeadImageUrl!=null&&i.HeadImageUrl!=""?e("img",{class:a.avata,src:`${L}${i.HeadImageUrl}`,onClick:()=>{l(i)}},null):e("img",{class:a.avata,src:N,onClick:()=>{l(i)}},null),e("div",{class:a.content},[e("span",{class:a.time},[U(i.last_message.createdatetime,o.minutesOffset,"YYYY-MM-DD")]),e(F,{dot:i.last_message.from_barcode!=n&&i.last_message.status===0},{default:()=>[e("h4",null,[m(i),C(" ")])]}),e("div",{class:a.msg},[g(i)])])])):e(P,{image:P.PRESENTED_IMAGE_SIMPLE},null)}return()=>e("div",{class:a.chatList},[t.lastMessages?b(t.lastMessages):e(R,null,null)])}}),We=f({name:"ChatSection",setup(){const{t:c}=h(),{chatStore:r}=y();return()=>e("div",{class:"ant-card ant-card-bordered"},[e("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[e("div",{class:"ant-card-head-wrapper"},[e("div",{class:"ant-card-head-title",onClick:()=>{r.chattingMsgs=r.targetUser=void 0,r.viewState=0}},[c("myItb.dockIcons.chat")])])]),e("div",{class:"ant-card-body",style:"padding: 2px;"},[r.viewState===0?e(Ue,null,null):e(Ce,null,null)])])}});export{We as default};
