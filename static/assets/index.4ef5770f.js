import{d as Q,k as s,j as ue,l as G,c as N,o as le,S as y,U as i,F as T,V as O,E as e,Q as H,W as pe,X as me,R as m,Y as _,P as V,Z as R,_ as x,u as D,i as _e,t as U,z as P}from"./@vue.ca0c2fb5.js";import{M as X}from"./MainSectionHead.713b3d1f.js";import{_ as fe,R as $,u as ae,S as se,a as oe,p as L}from"./index.fb345625.js";import{C as S,u as ne}from"./CalendarStore.7b206b87.js";import{B as j,M as ie,f as Z,S as ge,g as F,m as M,h as he,c as ye,i as W,j as re}from"./ant-design-vue.fcf1ac88.js";import{h as k}from"./moment.29305b8e.js";import{u as J}from"./vue-i18n.1e3f796f.js";import{u as ve}from"./vue-router.b7316d96.js";import{s as be}from"./index.module.4e44b35d.js";import{u as we}from"./ShowfloorStore.3dd80f76.js";import{P as De,k as xe,R as ke}from"./@ant-design.45c2fd2e.js";import"./nprogress.35503c85.js";import"./@rpdg.9741c2f9.js";import"./axios.7aed06b8.js";import"./@babel.a04268fa.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.647f38fa.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.19fb0a11.js";import"./source-map.e9534891.js";import"./vue.08638ec1.js";import"./@ctrl.2e36ce53.js";var de=Q({name:"CalendarBadgeTips",props:{online:{type:Boolean,required:!0}},setup(r){const{t:f}=J();return()=>s("div",{class:"pd_20 gridCols2 text_left"},[s(j,{color:S.Red,text:f("calendar.tips.1")},null),s(j,{color:S.Blue,text:f("calendar.tips.7")},null),s(j,{color:S.Yellow,text:r.online==!0?f("calendar.tips.3"):f("calendar.tips.6")},null),s(j,{color:S.Black,text:r.online==!0?f("calendar.tips.2"):f("calendar.tips.8")},null),s(j,{color:S.Gray,text:r.online==!0?f("calendar.tips.4"):f("calendar.tips.5")},null),s(j,{color:S.Green,text:f("calendar.tips.9")},null)])}});const Ce="_label_1dt6u_1",Se="_enewie_1dt6u_8",je="_checked_1dt6u_12",Me="_head_1dt6u_16",Be="_likelist_1dt6u_20",Ye="_modal_1dt6u_40",Te="_logo_1dt6u_45",$e="_squarelogo_1dt6u_53",Ee="_content_1dt6u_65",He="_grid3_1dt6u_73",Oe="_item_1dt6u_81",Re="_btn_1dt6u_94",Ue="_btn2_1dt6u_99",Pe="_loading_1dt6u_106",Le="_title_1dt6u_118";var C={label:Ce,enewie:Se,checked:je,head:Me,likelist:Be,modal:Ye,logo:Te,squarelogo:$e,content:Ee,grid3:He,item:Oe,btn:Re,btn2:Ue,loading:Pe,title:Le};const Ae=r=>(pe("data-v-73e317e6"),r=r(),me(),r),Ie={class:"pd_20 bg_white"},Ne={cellpadding:0,cellspacing:0,class:"table",border:""},Ve={class:"pd_20",style:{"text-align":"center","background-color":"#f5f5f5"}},Fe=Ae(()=>i("th",null,"Time",-1)),We={style:{"text-align":"center"}},qe={key:0,class:"btn"},Ke={style:{"max-height":"500px","overflow-y":"auto"}},ze=["src"],Qe=["src"],Ge=Q({setup(r){const f=ue(()=>b.role==$.buyer),{t:p}=J(),{calendarStore:v}=ne();let{authenStore:b}=ae(),{appStore:g}=oe(),{showfloorStore:h}=we();const E=new Map([["1012","10:00 - 12:00"],["1315","13:00 - 15:00"],["1517","15:00 - 17:00"]]),c=G(!1),B=N({IsOnline:0,ToBarcode:"",BeginDateTime:"",EndDateTime:""}),q=(n,t)=>{B.BeginDateTime=`${n} ${t.slice(0,2)}:00:00`,B.EndDateTime=`${n} ${t.slice(2)}:00:00`,Y(),c.value=!0},a=N({loading:!1,list:[],show:!1,wishDetail:{},destination:void 0,product:void 0,company:void 0,segment:void 0}),Y=async()=>{a.loading=!0,b.role==$.buyer?a.list=await L("NewExhibition/ListWithOutLike",{region:a.destination,product:a.product,companyType:a.company}):b.role==$.exhibition&&(a.destination||a.segment||a.product?a.list=await L("NewBuyer/ListWithOutLike",{region:a.destination,companyType:a.segment,product:a.product}):a.list=[]),a.loading=!1},A=n=>{a.wishDetail=n,a.show=!0},I=()=>{a.show=!1},K=()=>{a.destination=void 0,a.product=void 0,a.company=void 0,a.segment=void 0,a.list=[]},z=async n=>{try{B.ToBarcode=n,await v.addSchedule(B)?M.success(p("common.success")):M.error(p("common.failed"))}catch(t){switch(t.message){case"message_error_01":case"message_error_02":case"message_error_03":case"error_msg_001":case"error_msg_002":case"error_msg_003":M.error(p(`calendar.invite_errors.${t.message}`));break;default:M.error(t.message)}}};return le(()=>{v.getSchedules()}),(n,t)=>(m(),y("div",Ie,[i("table",Ne,[i("tr",Ve,[Fe,(m(!0),y(T,null,O(e(v).physicalMap2,l=>(m(),y("th",null,_(l[0]),1))),256))]),(m(!0),y(T,null,O(e(E),l=>(m(),y("tr",null,[i("td",We,_(l[1]),1),(m(!0),y(T,null,O(e(v).physicalMap2,d=>(m(),y("td",null,[(m(!0),y(T,null,O(e(v).physicalMap2.get(d[0]).get(l[0]),o=>(m(),y("div",null,[o.entry.company?(m(),V(e(j),{key:0,color:e(S)[o.color],text:o.entry.company},null,8,["color","text"])):R("",!0),o.entry.activity_title?(m(),V(e(j),{key:1,color:e(S)[o.color],text:o.entry.activity_title},null,8,["color","text"])):R("",!0)]))),256)),e(v).physicalMap2.get(d[0]).get(l[0]).length<5?(m(),y("div",qe,[s(e(Z),{type:"primary",shape:"circle",onClick:o=>q(d[0],l[0])},{icon:H(()=>[s(e(De))]),_:2},1032,["onClick"])])):R("",!0)]))),256))]))),256))]),s(e(ie),{visible:c.value,"onUpdate:visible":t[4]||(t[4]=l=>c.value=l),title:e(p)("calendar.schedule_meeting.title"),footer:null,width:800,onCancel:K},{default:H(()=>[s(e(ge),{class:"bg_white pd_20 mg_b_20",size:15,align:"baseline"},{default:H(()=>{var l,d,o,w;return[s(e(F),{allowClear:"",placeholder:e(b).role===e($).buyer?e(p)("showFloor.destination"):e(p)("wish.Q"),style:{width:"180px"},value:e(a).destination,"onUpdate:value":t[0]||(t[0]=u=>e(a).destination=u),options:(l=e(h).continentList)==null?void 0:l.map(u=>({value:e(g).isEn?u.chau_en:u.chau_cn})),onChange:Y},null,8,["placeholder","value","options"]),s(e(F),{allowClear:"",placeholder:e(b).role===e($).buyer?e(p)("showFloor.product"):e(p)("wish.P"),style:{width:"200px"},value:e(a).product,"onUpdate:value":t[1]||(t[1]=u=>e(a).product=u),options:(d=e(h).productTypes)==null?void 0:d.map(u=>{var te;return{value:u.id,label:(te=e(g).isEn?u.group_en:u.group_cn)==null?void 0:te.replaceAll(/[0-9]+\.[0-9]+/g,"")}}),onChange:Y},null,8,["placeholder","value","options"]),e(b).role===e($).exhibition?(m(),V(e(F),{key:0,allowClear:"",placeholder:e(p)("wish.O"),style:{width:"200px"},value:e(a).segment,"onUpdate:value":t[2]||(t[2]=u=>e(a).segment=u),options:(o=e(h).segmentTypes)==null?void 0:o.map(u=>({value:u.id,label:e(g).isEn?u.en:u.cn})),onChange:Y},null,8,["placeholder","value","options"])):R("",!0),e(b).role===e($).buyer?(m(),V(e(F),{key:1,allowClear:"",placeholder:e(p)("showFloor.company"),style:{width:"200px"},value:e(a).company,"onUpdate:value":t[3]||(t[3]=u=>e(a).company=u),options:(w=e(h).companyTypes)==null?void 0:w.map(u=>({value:u.id,label:e(g).isEn?u.companytype_en:u.companytype_cn})),onChange:Y},null,8,["placeholder","value","options"])):R("",!0)]}),_:1}),i("div",Ke,[i("div",{class:x(e(C).grid3),style:{"margin-bottom":"20px"}},[(m(!0),y(T,null,O(e(a).list,(l,d)=>{var o;return m(),y("div",{class:x(e(C).item)},[i("img",{class:x(e(C).squarelogo),src:`${e(se)}${e(f)?e(g).isEn?l.company_logo_en!==""?l.company_logo_en:l.company_logo:l.company_logo!==""?l.company_logo:l.company_logo_en:l.company_logo}`},null,10,ze),i("div",null,[i("div",{style:{"text-align":"left",width:"100%"},class:x(e(C).title)},_((o=l.company)!=null?o:e(g).isEn?l.companyname_en:l.companyname_cn),3),i("div",{class:x(e(C).btn2)},[s(e(Z),{class:x(e(C).btn),block:"",onClick:w=>A(l)},{default:H(()=>[D(_(e(p)("wish.info")),1)]),_:2},1032,["class","onClick"]),s(e(Z),{type:"primary",block:"",class:x(e(C).btn),onClick:w=>z(l.barcode)},{default:H(()=>[D(_(e(p)("calendar.btn_invite")),1)]),_:2},1032,["class","onClick"])],2)])],2)}),256))],2)])]),_:1},8,["visible","title"]),s(e(ie),{visible:e(a).show,footer:null,width:800,centered:"",onCancel:I,maskClosable:!0},{default:H(()=>{var l,d,o;return[i("img",{src:`${e(se)}${e(f)?e(g).isEn?e(a).wishDetail.company_logo_en!==""?e(a).wishDetail.company_logo_en:e(a).wishDetail.company_logo:e(a).wishDetail.company_logo!==""?e(a).wishDetail.company_logo:e(a).wishDetail.company_logo_en:e(a).wishDetail.company_logo}`,class:x(e(C).logo),style:{height:"150px"}},null,10,Qe),i("h3",null,_(e(a).wishDetail.company),1),e(f)?(m(),y("div",{key:0,class:x(e(C).content)},[i("div",null,[i("label",null,_(e(p)("wish.segments"))+": ",1),D(" "+_((l=e(g).isEn?e(a).wishDetail.segments_en:e(a).wishDetail.segments_cn)==null?void 0:l.join(",")),1)]),i("div",null,[i("label",null,_(e(p)("wish.product"))+": ",1),D(" "+_((d=e(g).isEn?e(a).wishDetail.product_en:e(a).wishDetail.product_cn)==null?void 0:d.join(",").replaceAll(/[0-9]+\.[0-9]+/g,"")),1)]),i("div",null,[i("label",null,_(e(p)("wish.region2"))+": ",1),D(" "+_((o=e(g).isEn?e(a).wishDetail.region2_en:e(a).wishDetail.region2_cn)==null?void 0:o.join(",")),1)])],2)):(m(),y("div",{key:1,class:x(e(C).content)},[i("div",null,[i("label",null,_(e(p)("wish.O"))+": ",1),D(_(e(a).wishDetail.O),1)]),i("div",null,[i("label",null,_(e(p)("wish.P"))+": ",1),D(_(e(a).wishDetail.P),1)]),i("div",null,[i("label",null,_(e(p)("wish.Q"))+": ",1),D(_(e(a).wishDetail.Q),1)])],2))]}),_:1},8,["visible"])]))}});var ce=fe(Ge,[["__scopeId","data-v-73e317e6"]]);function ee(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!_e(r)}var St=Q({components:{Schedule2:ce},setup(){const{t:r}=J(),{appStore:f}=oe(),p=ve(),{calendarStore:v}=ne();let b=k("2023-09-01"),{authenStore:g}=ae(),h=N({tip:"",virtualMoment:k(b)});const E=G(["0"]);G(!1);const c=N({2309121012:{id:void 0,status:!1,loading:!1},2309121315:{id:void 0,status:!1,loading:!1},2309121517:{id:void 0,status:!1,loading:!1},2309131012:{id:void 0,status:!1,loading:!1},2309131315:{id:void 0,status:!1,loading:!1},2309131517:{id:void 0,status:!1,loading:!1},2309141012:{id:void 0,status:!1,loading:!1},2309141315:{id:void 0,status:!1,loading:!1},2309141517:{id:void 0,status:!1,loading:!1}}),B=async()=>{var t;for(const l in c)c[l].status=!1,c[l].id=void 0;(await L("Dashboard/GetBusyDateByBarCode",{barCode:(t=g.user)==null?void 0:t.barcode})).forEach(l=>{const d=k(l.busybegindate).format("MMDDHH");for(const o in c)c[o].loading=!0,o.includes(d)&&(c[o].status=!0,c[o].id=l.id),c[o].loading=!1})},q=async(n,t,l)=>{try{c[l].loading=!0,await L("UserBusyDate/AddBusyDate",{BusyBeginDate:n,BusyEndDate:t}),M.success(r("common.success")),c[l].loading=!1}catch(d){B();let o=d.message;M.error(r(`calendar.blockTime.${o}`))}},a=async(n,t,l,d)=>{var o;try{c[d].loading=!0;let w=await L("UserBusyDate/DelBusyDateForMoreParams",{barcode:(o=g.user)==null?void 0:o.barcode,beginDate:t,endDate:l});w==="ok"?(c[d].loading=!1,M.success(r("common.success"))):w==="bad"&&(B(),M.error(r("common.failed")))}catch(w){M.error(r("common.failed"))}},Y=(n,t,l)=>{const d=`${l.slice(0,8)}0000`,o=k(d,"YYMMDDHHmmss").format("YYYY-MM-DD HH:mm:ss"),w=k(d,"YYMMDDHHmmss").add(2,"h").format("YYYY-MM-DD HH:mm:ss");t?q(o,w,l):n&&a(n,o,w,l)};le(()=>{if(!v.inited){const n={beginDate:k(b).startOf("year").format("YYYY-MM-DD HH:mm:ss"),endDate:k(b).endOf("year").format("YYYY-MM-DD HH:mm:ss")};v.getVirtualCalendar(n),v.getPhysicalCalendar(n)}v.getTextTip(f.isEn).then(n=>{h.tip=n}),B()});function A(n,{current:t}){let l=t.format("YYYY-MM-DD"),d=n?v.virtualMap:v.physicalMap;if(d.has(l))return d.get(l).map(o=>s(j,{color:`${S[o]}`,key:`${n}-${l}-${o}`},null))}function I(n,t){let l=k(t).format("YYYY-MM-DD");p.push(`/calendar/${n?"virtual":"physical"}/${l}`)}function K(){return g.role==="buyer"}function z(){return h.tip!=null&&h.tip!=""}return()=>{let n;return s(T,null,[s(X,{redLead:!1},ee(n=r("menu.calendar"))?n:{default:()=>[n]}),U(s(he,{message:h.tip,type:"error"},null),[[P,z()]]),U(s("div",{class:"bg_white pd_20 mg_b_20"},[s("p",null,[r("calendar.blockTime.content")]),s("div",{style:{display:"flex"}},[s("div",{style:{display:"grid",gridTemplateRows:" repeat(3, 1fr)",gap:"16px",marginRight:"32px"}},[s("div",{style:{fontWeight:"bold"}},[D("2023-09-12")]),s("div",{style:{fontWeight:"bold"}},[D("2023-09-13")]),s("div",{style:{fontWeight:"bold"}},[D("2023-09-14")])]),s("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px"}},[Object.keys(c).map(t=>s(T,null,[s("div",{class:c[t].status?be.checked:""},[s("span",{class:"mg_r_20"},[`${t.slice(6,8)}:00-${t.slice(8,10)}:00`]),s(ye,{checked:c[t].status,"onUpdate:checked":l=>c[t].status=l,loading:c[t].loading,style:{width:"70px"},"checked-children":r("calendar.blockTime.block"),onChange:l=>{Y(c[t].id,l,t)}},null)])]))])])]),[[P,K()]]),U(s(W,{expandIconPosition:"right",style:{margin:"20px 0"},activeKey:E.value,"onUpdate:activeKey":t=>E.value=t},{default:()=>[s(W.Panel,{key:"1"},{default:()=>[s(re,{fullscreen:!0,value:h.virtualMoment,"onUpdate:value":t=>h.virtualMoment=t,onSelect:t=>{I(!0,t)}},{headerRender:({value:t,onChange:l})=>s("h3",{class:"text_center"},[s(xe,{class:"cursor_hand",style:{visibility:h.virtualMoment.month()<11?"hidden":"visible"},onClick:()=>{l(t.clone().month(10))}},null)," ",k.months()[h.virtualMoment.month()]," ",s(ke,{class:"cursor_hand",style:{visibility:h.virtualMoment.month()===11?"hidden":"visible"},onClick:()=>{l(t.clone().month(11))}},null)]),dateCellRender:t=>A(!0,t)}),s(de,{online:!0},null)],header:()=>{let t;return s(X,{redLead:!0,inner:!0},ee(t=r("calendar.virtual_platform_calendar"))?t:{default:()=>[t]})}})]}),[[P,!1]]),U(s(W,{expandIconPosition:"right",activeKey:E.value,"onUpdate:activeKey":t=>E.value=t},{default:()=>[s(W.Panel,{key:"2"},{default:()=>[U(s(re,{fullscreen:!0,value:b,"onUpdate:value":t=>b=t,onSelect:t=>{I(!1,t)}},{headerRender:()=>s("h3",{class:"text_center"},[k.months()[10]]),dateCellRender:t=>A(!1,t)}),[[P,!1]]),s(ce,null,null),s(de,{online:!1},null)],header:()=>{let t;return s(X,{redLead:!0,inner:!0},ee(t=r("calendar.physical_exhibition_calendar"))?t:{default:()=>[t]})}})]}),[[P,!1]])])}}});export{St as default};
