import{u as V,B as _,a as R}from"./index.0b6644c7.js";import{v as T}from"./@rpdg.8b8261fd.js";import{F as l,b as u,g as c,x as w,n as O,M as P}from"./ant-design-vue.185fab3e.js";import{u as F}from"./vue-i18n.f56f8be1.js";import{a as M,u as U,d as B}from"./vue-router.82b024de.js";import{Q as L,T as q,O as A}from"./@ant-design.3b6fcf97.js";import{d as E,I as N,l as g,c as f,k as o,i as W}from"./@vue.b2913f50.js";function p(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!W(n)}var X=E({name:"Login_SmsForm",setup(){const{authenStore:n}=V(),{appStore:v}=R(),b=M(),h=U(),{t:r}=F({useScope:"global"});N(()=>{n.getImgCode()});const d=g(),e=f({action:"sms",mobile:"",graphVerifyCode:"",verifyCode:"",agreed:!0,sendingSms:!1}),m=r("myItb.chat.send"),y="59",s=g(m);let C=async(a,i)=>T(i)?Promise.resolve():Promise.reject(r("login.mobileTip2")),S=async(a,i)=>e.action==="login"&&i===""?Promise.reject(r("login.smsCodeTip")):Promise.resolve();const k=f({mobile:[{required:!0,message:r("login.mobileTip"),trigger:"change"},{validator:C,trigger:"change"}],graphVerifyCode:[{required:!0,message:r("login.graphicCodeTip"),trigger:"change"}],verifyCode:[{validator:S,trigger:"change"}]});async function j(){e.action="sms";try{await d.value.validate(),e.sendingSms=!0,s.value=y;let a=setInterval(function(){~~s.value-1<1?(clearInterval(a),e.sendingSms=!1,s.value=m):s.value=~~s.value-1},1e3);await n.sendSmsCode(e.mobile,e.graphVerifyCode)&&O.success({message:r("login.smsSendSuccess")})}catch(a){console.log("error",a)}}async function I(){var a,i;e.action="login";try{await d.value.validate(),await n.loginWithSms(e.mobile,e.verifyCode),h.push((i=(a=b.query)==null?void 0:a.redirect)!=null?i:"/home")}catch(t){let x=t.message;P.error({content:r(x==="Username or password error"?"login.login_error1":"login.login_error2"),okText:r("login.okbtn")})}}return()=>{let a,i;return o(l,{ref:d,model:e,rules:k},{default:()=>[o(l.Item,{name:"mobile",validateFirst:!0},{default:()=>[o(u,{value:e.mobile,"onUpdate:value":t=>e.mobile=t,placeholder:r("login.mobile")},{prefix:()=>o(L,{style:"color: rgba(0, 0, 0, 0.25)"},null)})]}),o(l.Item,{name:"graphVerifyCode"},{default:()=>[o(u,{value:e.graphVerifyCode,"onUpdate:value":t=>e.graphVerifyCode=t,placeholder:r("login.graphicCode")},{prefix:()=>o(q,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>{var t;return o("img",{src:((t=n.graphicRes)==null?void 0:t.graphVerifyCodeImg)||_},null)}})]}),o(l.Item,{name:"verifyCode"},{default:()=>[o(u,{value:e.verifyCode,"onUpdate:value":t=>e.verifyCode=t,placeholder:r("login.smsCode")},{prefix:()=>o(A,{style:"color: rgba(0, 0, 0, 0.25)"},null),suffix:()=>o(c,{style:{backgroundColor:"black",color:"white"},onClick:j,disabled:e.sendingSms},{default:()=>[s.value]})})]}),o(l.Item,{name:"agreed"},{default:()=>[o(w,{checked:e.agreed,"onUpdate:checked":t=>e.agreed=t},{default:()=>[o(B,{to:v.isEn?"/agreementEn":"/agreement"},p(a=r("login.agreeTip"))?a:{default:()=>[a]})]})]}),o(l.Item,null,{default:()=>[o(c,{type:"primary",block:!0,disabled:!e.agreed,loading:n.loading,onClick:I},p(i=r("login.login"))?i:{default:()=>[i]})]})]})}}});export{X as S};
