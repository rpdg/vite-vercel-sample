import{a as S,u as C,d as f,L as N,U as D}from"./index.e1dbd58b.js";import{u as v}from"./vue-i18n.0711e616.js";import{p}from"./Image.f0a737d7.js";import{I as H,g as O,B as $,G as k}from"./ant-design-vue.0721aa65.js";import{d as m,k as t,u as x,l as B,o as L,c as T,i as Y,n as q}from"./@vue.fa05379c.js";import"./vue-router.8ec3c3d8.js";import"./moment.29305b8e.js";import"./@ant-design.8f5596ac.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.a57df465.js";import"./@babel.288dabcc.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.e58a7599.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.0eca950e.js";import"./source-map.3671d69c.js";import"./vue.d22487d2.js";import"./BlankGif.8ca146ab.js";import"./Config.87ac60ee.js";const A="_chatList_lw0gu_1",G="_chatItem_lw0gu_1",R="_avata_lw0gu_12",V="_content_lw0gu_19",P="_time_lw0gu_23",z="_msg_lw0gu_29",J="_chatSection_lw0gu_43",W="_targetUserInfo_lw0gu_46",F="_info_lw0gu_57",K="_chatMsgBox_lw0gu_61",Q="_invite_lw0gu_69",X="_invite_title_lw0gu_81",Z="_invite_content_lw0gu_84",tt="_bubble_lw0gu_96",et="_left_lw0gu_110",at="_right_lw0gu_125",st="_sender_lw0gu_141";var e={chatList:A,chatItem:G,avata:R,content:V,time:P,msg:z,chatSection:J,targetUserInfo:W,info:F,chatMsgBox:K,invite:Q,invite_title:X,invite_content:Z,bubble:tt,left:et,right:at,sender:st},nt=m({name:"ChattingMessage",props:{msg:{type:Object,required:!0},selfBarCode:{type:String,required:!0}},setup(i){const{msg:n,selfBarCode:s}=i;return()=>t("div",{key:n.id,class:`${e.bubble} ${n.to_barcode===s?e.left:e.right}`},[t("p",null,[n.msgcontent])])}}),rt=m({props:{msg:{type:Object,required:!0},targetUserName:String},setup(i){const{t:n}=v(),{msg:s,targetUserName:a}=i;let c=JSON.parse(s.msgcontent);return()=>t("div",{class:`pd_20 ${e.invite}`,key:s.id},[t("p",{class:e.invite_title},[a,x(" "),n("myItb.chat.invite_you_attend")]),t("div",{class:e.invite_content},[t("img",{src:p(s.from_HeadImageUrl),alt:""},null),t("img",{src:p(s.to_HeadImageUrl),alt:""},null),t("div",{class:"text_gray mg_l_20"},[t("p",{class:"text_12"},[`${c.beginDate.substr(0,10)}`,t("br",null,null),`${c.beginDate.substr(11,5)} ~ ${c.endDate.substr(11,5)}`]),t("p",null,null)])])])}});function ot(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Y(i)}var it=m({name:"Chat",setup(){var b,y,j,U;const{t:i}=v(),{appStore:n}=C(),{authenStore:s}=S(),{chatStore:a}=f(),c=B(""),g=B(),_=s.user.barcode;L(async()=>{await a.getChattingMessages(a.targetUser.employee_id),o()});function o(){let d=g.value;d.scrollTop=d.scrollHeight}async function r(){c.value&&(await a.sendChattingMessage(c.value),c.value="",q(o))}function E(d){return d.map(l=>{if(l.msgtype<2)return t(nt,{key:l.id,msg:l,selfBarCode:_},null);if(l.msgtype<6)return t(rt,{msg:l,targetUserName:h.name,key:l.id},null);if(l.msgtype===6)return t("div",{class:`pd_20 ${e.invite}`},[x("\u540D\u7247")])})}let h=T({name:n.isEn?((b=a.targetUser)==null?void 0:b.firstname)+" "+((y=a.targetUser)==null?void 0:y.lastname):""+((j=a.targetUser)==null?void 0:j.lastname_cn)+((U=a.targetUser)==null?void 0:U.firstname_cn)});return()=>{var d,l,M,I,w;return t("section",{class:e.chatSection,key:(d=a.targetUser)==null?void 0:d.employee_id},[t("div",{class:e.targetUserInfo},[t("img",{class:e.avata,src:p((l=a.targetUser)==null?void 0:l.HeadImageUrl)},null),t("div",{class:e.info},[t("h4",null,[h.name]),t("div",null,[(M=a.targetUser)==null?void 0:M.job_title]),t("div",null,[n.isEn?(I=a.targetUser)==null?void 0:I.company:(w=a.targetUser)==null?void 0:w.company_cn])])]),t("div",{ref:g,class:e.chatMsgBox},[a.chattingMsgs&&E(a.chattingMsgs)]),t("div",{class:e.sender},[t(H,{type:"text",value:c.value,"onUpdate:value":u=>c.value=u},{suffix:()=>{let u;return t(O,{style:{backgroundColor:"black",color:"white"},onClick:r},ot(u=i("myItb.chat.send"))?u:{default:()=>[u]})}})])])}}}),ct=m({name:"MsgList",setup(){var _;const{appStore:i}=C(),{authenStore:n}=S(),{chatStore:s}=f(),a=(_=n.user)==null?void 0:_.barcode;L(()=>{s.chattingMsgs=s.targetUser=void 0,s.lastMessages?s.getLastMessages():s.refreshMsgList()});function c(o){let r={job_title:o.job_title,employee_id:o.barcode,HeadImageUrl:o.HeadImageUrl,firstname_cn:o.firstname_cn,firstname:o.firstname,lastname_cn:o.lastname_cn,lastname:o.lastname,company:o.company,company_cn:o.company_cn,IsOnline:0};s.chatWith(r)}function g(o){return o.length>0?o.map(r=>t("div",{key:r.barcode,class:e.chatItem,onClick:()=>{c(r)}},[t("img",{class:e.avata,src:p(r.HeadImageUrl),onClick:()=>{c(r)}},null),t("div",{class:e.content},[t("span",{class:e.time},[D(r.last_message.createdatetime,n.minutesOffset,"YYYY-MM-DD")]),t($,{dot:r.last_message.from_barcode!=a&&r.last_message.status===0},{default:()=>[t("h4",null,[i.isEn?r.firstname+" "+r.lastname:r.lastname_cn+r.firstname_cn," "])]}),t("div",{class:e.msg},[r.last_message.msgcontent])])])):t(k,{image:k.PRESENTED_IMAGE_SIMPLE},null)}return()=>t("div",{class:e.chatList},[s.lastMessages?g(s.lastMessages):t(N,null,null)])}}),Ot=m({name:"ChatSection",setup(){const{t:i}=v(),{chatStore:n}=f();return()=>t("div",{class:"ant-card ant-card-bordered"},[t("div",{class:"ant-card-head",style:"border-bottom-color: #e0e0e0;"},[t("div",{class:"ant-card-head-wrapper"},[t("div",{class:"ant-card-head-title",onClick:()=>{n.chattingMsgs=n.targetUser=void 0,n.viewState=0}},[i("myItb.dockIcons.chat")])])]),t("div",{class:"ant-card-body",style:"padding: 2px;"},[n.viewState===0?t(ct,null,null):t(it,null,null)])])}});export{Ot as default};
