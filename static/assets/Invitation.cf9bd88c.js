var E=Object.defineProperty;var N=(n,t,r)=>t in n?E(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var j=(n,t,r)=>(N(n,typeof t!="symbol"?t+"":t,r),r);import{p as x,g as W}from"./index.85c56bf3.js";import{B as K,l as w}from"./@rpdg.2a67823e.js";import{F as p,k as f,l as u,b as P,o as F,E as H,p as q,q as J,W as Q,x as X,f as R,n as Z,G as ee,M as te}from"./ant-design-vue.2fa23891.js";import{h as v}from"./moment.29305b8e.js";import{u as U}from"./vue-i18n.97207468.js";import{s as ae}from"./index.module.c8493ae7.js";import{d as L,l as D,c as $,o as A,w as re,k as e,i as z,u as G,F as S,j as ne}from"./@vue.c3fad188.js";import"./vue-router.c781243b.js";import"./@ant-design.f49dba90.js";import"./@ctrl.2e36ce53.js";import"./nprogress.35503c85.js";import"./axios.7aed06b8.js";import"./@babel.a04268fa.js";import"./regenerator-runtime.8463e994.js";import"./omit.js.0925d6dc.js";import"./lodash-es.647f38fa.js";import"./warning.ca82f8e0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./async-validator.1fa0d626.js";import"./scroll-into-view-if-needed.c68eec67.js";import"./compute-scroll-into-view.6058b3be.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./@intlify.19fb0a11.js";import"./source-map.e9534891.js";import"./vue.f1721d35.js";var ie=Object.defineProperty,le=Object.getOwnPropertyDescriptor,I=(n,t,r,l)=>{for(var a=l>1?void 0:l?le(t,r):t,m=n.length-1,b;m>=0;m--)(b=n[m])&&(a=(l?b(t,r,a):b(a))||a);return l&&a&&ie(t,r,a),a};class g extends K{constructor(){super();j(this,"currentRecord");j(this,"list");j(this,"pageIndex");j(this,"pageSize");j(this,"totalRecords");this.pageIndex=0,this.totalRecords=0,this.pageSize=10}async fetchList(t,r){let l=await x("/operation/Getletterlistbyuser",{pageIndex:t,pageSize:r||this.pageSize});this.list=l.results,this.pageIndex=t,this.totalRecords=l.totalRecord}async addLetter(t){return await x("Operation/AddLetter",t)}async downloadPdf(t){let r=await x("Operation/CreatePDF",{letterid:t});window.open(r.filename,"_blank")}async deleteLetter(t){return await x("Operation/DeleteLetter",{letterid:t})}async getLetter(t){return await x("Operation/GetLetter",{letterid:t})}async editLetter(t){return await x("Operation/EditLetter",t)}}I([w],g.prototype,"fetchList",1);I([w],g.prototype,"addLetter",1);I([w],g.prototype,"downloadPdf",1);I([w],g.prototype,"deleteLetter",1);I([w],g.prototype,"getLetter",1);I([w],g.prototype,"editLetter",1);const oe=new g,V=function(){return{invitationStore:oe}};var se="/assets/pic.ff892424.jpg";function k(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!z(n)}const pe=p.useForm;var de=L({name:"InvitationForm",setup(){const n="YYYY-MM-DD",{t}=U(),{invitationStore:r}=V(),l=D();let a=$({countryname:"",username:"",position:"",gender:"Male",dateofbirth:"",nationality:"",passportnumber:"",passportvalidity:"",employer:"",starttime:"",stoptime:"",iknow:!1,residence:[],dateofbirthP:void 0,passportvalidityP:void 0});const m=D([]);async function b(){let c=await W("/country/GetAllCountryExceptChina");m.value=c.map(s=>({value:s.name_en,label:s.name_en}))}A(()=>{b()}),re(()=>r.currentRecord,()=>{a.letterid=r.currentRecord.invitationid,a.username=r.currentRecord.username,a.dateofbirthP=v(r.currentRecord.dateofbirth),a.nationality=r.currentRecord.nationality,a.gender=r.currentRecord.gender,a.employer=r.currentRecord.employer,a.position=r.currentRecord.position,a.passportnumber=r.currentRecord.passportnumber,a.passportvalidityP=v(r.currentRecord.passportvalidity),a.countryname=r.currentRecord.countryname,a.residence=[v(r.currentRecord.starttime,n),v(r.currentRecord.stoptime,n)],a.iknow=!0});let _=async(c,s)=>!s||s.length<2?Promise.reject(t("planMyTrip.errortimeinfo")):Promise.resolve(),o=async(c,s)=>{if(s)return v().subtract(18,"years").isSameOrAfter(s)?Promise.resolve():Promise.reject(t("planMyTrip.dateofbirthTip18"))},d=async(c,s)=>{if(s&&a.residence[1])return v(s).isAfter(a.residence[1])?Promise.resolve():Promise.reject(t("planMyTrip.dateofbirthTip18"))};const T=$({countryname:[{required:!0,message:t("planMyTrip.countrynameTip")}],username:[{required:!0,message:t("planMyTrip.usernameTip")}],nationality:[{required:!0,message:t("planMyTrip.nationalityTip")}],passportnumber:[{required:!0,message:t("planMyTrip.passportnumberTip")}],dateofbirthP:[{required:!0,message:t("planMyTrip.dateofbirthTip")},{validator:o}],passportvalidityP:[{required:!0,message:t("planMyTrip.passportvalidityTip")},{validator:d}],gender:[{required:!0,message:t("planMyTrip.gender")}],employer:[{required:!0,message:t("planMyTrip.employer")}],position:[{required:!0,message:t("planMyTrip.position")}],residence:[{required:!0,message:t("planMyTrip.residence")},{validator:_}]}),{resetFields:C}=pe(a,T);async function B(){var c,s,M,h;try{await l.value.validate(),a.dateofbirth=(c=a.dateofbirthP)==null?void 0:c.format(n),a.passportvalidity=(s=a.passportvalidityP)==null?void 0:s.format(n),a.starttime=(M=a.residence[0])==null?void 0:M.format(n),a.stoptime=(h=a.residence[1])==null?void 0:h.format(n);let y;a.letterid?y=await r.editLetter(a):y=await r.addLetter(a),y&&(Z.success({message:t("planMyTrip.submitinfo"),placement:"topRight"}),C(),r.fetchList(0))}catch(y){}}return()=>{let c,s,M,h,y;return e(S,null,[e("div",{class:ae.formInfoSection},[e("img",{src:se},null),e("div",null,[e("h3",{class:"text_red"},[t("planMyTrip.formtitle")]),e("span",null,[t("planMyTrip.topinfo1")]),e("span",null,[t("planMyTrip.topinfo2",{email:"contact@itb-china.com"})]),e("br",null,null)])]),e(p,{ref:l,model:a,rules:T},{default:()=>[e(f,{gutter:20},{default:()=>[e(u,{span:12},{default:()=>[e(p.Item,{name:"username",label:t("planMyTrip.username")},{default:()=>[e(P,{type:"text",value:a.username,"onUpdate:value":i=>a.username=i},null)]})]}),e(u,{span:12},{default:()=>[e(p.Item,{name:"dateofbirthP",label:t("planMyTrip.dateofbirth")},{default:()=>[e(F,{style:{width:"100%"},value:a.dateofbirthP,"onUpdate:value":i=>a.dateofbirthP=i},null)]})]})]}),e(f,{gutter:20},{default:()=>[e(u,{span:12},{default:()=>[e(p.Item,{name:"nationality",label:t("planMyTrip.nationality")},{default:()=>[e(P,{type:"text",value:a.nationality,"onUpdate:value":i=>a.nationality=i},null)]})]}),e(u,{span:12},{default:()=>[e(p.Item,{name:"gender",label:t("planMyTrip.gender")},{default:()=>[e(H,{value:a.gender,"onUpdate:value":i=>a.gender=i},{default:()=>[e(q,{value:"Male"},k(c=t("planMyTrip.gendercontent[0]"))?c:{default:()=>[c]}),e(q,{value:"Female"},k(s=t("planMyTrip.gendercontent[1]"))?s:{default:()=>[s]})]})]})]})]}),e(f,{gutter:20},{default:()=>[e(u,{span:12},{default:()=>[e(p.Item,{name:"employer",label:t("planMyTrip.employer")},{default:()=>[e(P,{type:"text",value:a.employer,"onUpdate:value":i=>a.employer=i},null)]})]}),e(u,{span:12},{default:()=>[e(p.Item,{name:"position",label:t("planMyTrip.position")},{default:()=>[e(P,{type:"text",value:a.position,"onUpdate:value":i=>a.position=i},null)]})]})]}),e(f,{gutter:20},{default:()=>[e(u,{span:12},{default:()=>[e(p.Item,{name:"passportnumber",label:t("planMyTrip.passportnumber")},{default:()=>[e(P,{type:"text",value:a.passportnumber,"onUpdate:value":i=>a.passportnumber=i},null)]})]}),e(u,{span:12},{default:()=>[e(p.Item,{name:"passportvalidityP",label:t("planMyTrip.passportvalidity")},{default:()=>[e(F,{style:{width:"100%"},value:a.passportvalidityP,"onUpdate:value":i=>a.passportvalidityP=i},null)]})]})]}),e(f,{gutter:20},{default:()=>[e(u,{span:12},{default:()=>[e(p.Item,{name:"countryname",label:t("planMyTrip.countryname")},{default:()=>[e(J,{value:a.countryname,"onUpdate:value":i=>a.countryname=i,style:"width: 100%",options:m.value},null)]})]}),e(u,{span:12},{default:()=>[e(p.Item,{name:"residence",label:t("planMyTrip.residence")},{default:()=>[e(Q,{style:{width:"100%"},value:a.residence,"onUpdate:value":i=>a.residence=i,defaultPickerValue:["2023-09","2023-10"],disabledDate:i=>i<v("2023-9-5").startOf("day")||i>v("2023-9-19").endOf("day")},null)]})]})]}),e(f,null,{default:()=>[e(p.Item,{name:"iknow"},{default:()=>[e(X,{checked:a.iknow,"onUpdate:checked":i=>a.iknow=i},k(M=t("planMyTrip.formatattention"))?M:{default:()=>[M]})]})]}),e(f,null,{default:()=>[e("p",{class:"text_red"},[t("planMyTrip.formatattention2"),G(" "),e("br",null,null),G(" "),t("planMyTrip.formatattention3")])]}),e(f,{type:"flex",gutter:20},{default:()=>[e(u,{flex:1,style:{textAlign:"right"}},{default:()=>[e(R,{type:"primary",disabled:!a.iknow,loading:r.loading,onClick:B},k(h=t("planMyTrip.sendApply"))?h:{default:()=>[h]})]}),e(u,{flex:1},{default:()=>[e(R,{onClick:C},k(y=t("planMyTrip.reset"))?y:{default:()=>[y]})]})]})]})])}}});function O(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!z(n)}var ue=L({name:"InvitationTable",setup(n,{emit:t}){const{t:r}=U(),{invitationStore:l}=V();A(()=>{l.fetchList(0)});let a=ne(()=>({current:l.pageIndex,total:l.totalRecords}));async function m(o){let d=await l.getLetter(o);l.currentRecord=d.Table[0]}function b(o){te.confirm({content:r("planMyTrip.deleteinfo"),onOk:async()=>{await l.deleteLetter(o)&&l.fetchList(0)},okText:r("common.confirm"),onCancel:()=>{},cancelText:r("common.cancel")})}const _=[{title:r("planMyTrip.countryname"),dataIndex:"countryname"},{title:r("planMyTrip.username"),dataIndex:"username"},{title:r("planMyTrip.gender"),dataIndex:"gender"},{title:r("planMyTrip.dateofbirth"),dataIndex:"dateofbirth",customRender:({record:o})=>`${o.dateofbirth.split(" ")[0]}`},{title:r("planMyTrip.position"),dataIndex:"position"},{title:r("planMyTrip.nationality"),dataIndex:"nationality"},{title:r("planMyTrip.passportnumber"),dataIndex:"passportnumber"},{title:r("planMyTrip.passportvalidity"),dataIndex:"passportvalidity",customRender:({record:o})=>`${o.passportvalidity.split(" ")[0]}`},{title:r("planMyTrip.employer"),dataIndex:"employer"},{title:r("planMyTrip.residence"),dataIndex:"strattime",customRender:({record:o})=>`${o.starttime.split(" ")[0]} -- ${o.stoptime.split(" ")[0]}`},{title:r("planMyTrip.createtime"),dataIndex:"createtime"},{title:r("planMyTrip.status"),dataIndex:"status",customRender:({record:o})=>r(`planMyTrip.statustype[${o.status}]`)},{title:r("planMyTrip.operation"),dataIndex:"invitationid",align:"center",fixed:"right",customRender({record:o}){if(o.status==="1"){let d;return e(R,{type:"link",onClick:()=>{l.downloadPdf(o.invitationid)}},O(d=r("planMyTrip.operationbutton"))?d:{default:()=>[d]})}else if(o.status==="0"){let d,T;return e(S,null,[e(R,{type:"link",onClick:()=>{m(o.invitationid)}},O(d=r("planMyTrip.edit"))?d:{default:()=>[d]}),e(R,{type:"link",onClick:()=>{b(o.invitationid)}},O(T=r("planMyTrip.delete"))?T:{default:()=>[T]})])}}}];return()=>e("div",{class:"pd_tb_20"},[e(ee,{size:"small",bordered:!0,rowKey:"invitationid",dataSource:l.list,columns:_,loading:l.loading,scroll:{x:1400,y:500},pagination:{current:a.value.current,total:a.value.total,onChange:o=>{l.fetchList(o)}}},{title:()=>e("h3",null,[r("planMyTrip.list")])})])}});const Y={Table:ue,Form:de};var Ae=L({name:"PlanMyInvitation",setup(){return()=>e(S,null,[e(Y.Form,null,null),e(Y.Table,null,null)])}});export{Ae as default};
